define("wo/publish_more_topic",["base_package","frame_package","btn_package","wo_config","commom_function","get_template","footer_view","notice","new_alert_v2"],function(e,i){var a=e("zepto"),t=e("wo_config"),n=e("page_control"),d=e("backbone"),o=e("commom_function"),s=e("mustache");e("notice"),e("cookies");var l=e("new_alert_v2");i.route={publish_more_topic:"publish_more_topic"},i.new_page_entity=function(){function i(){x.$el.find(".topic-list").html(""),y.each(function(e){var i=new b({model:e});x.$el.find(".topic-list").append(i.$el)})}function r(e){x.$el.find("[data_custom_topic]").html(""),a(e).each(function(i,a){if(e.length>0){var t=new u({model:a});x.$el.find("[data_custom_topic]").append(t.$el)}})}function c(e){var i=JSON.stringify(e);window.localStorage.setItem("record_topic_arr",i)}function _(){return JSON.parse(window.localStorage.getItem("record_topic_arr"))}function m(e){for(var i=0;e.length>i;i++)for(var a=i+1;e.length>a;a++)e[i].keyword===e[a].keyword&&(e.splice(a,1),a--);return e.sort(function(e,i){return e-i})}var p={route:{publish_more_topic:"publish_more_topic"},transition_type:"fade",dom_not_cache:!1,ignore_exist:!1},f=/(^\s*)|(\s*$)/g;p.initialize=function(){this.render()},p.render=function(){var e=this,i='<div class="publish_more_page wrap-box font_wryh pb15"><header class="header re tc fb">\u66f4\u591a\u8bdd\u9898</header><div class="select-item-wrap p15" style="margin-top:45px"><div class="select-item bgcfff"><table border="0" cellspacing="0" cellpadding="0" class="w-100 h-100 f12"><tr><td width="30" align="left"><em class="select-topic-icon icon-bg-common"></em></td><td><div class="input-box"><input type="text" class="input-class w-100 bdn bgn" data_to_topic_vaule value="" placeholder="\u8bf7\u63d2\u5165\u81ea\u5b9a\u4e49\u8bdd\u9898\u540d\u79f0"></div></td><td width="55"><div class="ui-btn-register btn-confirm oh" data_to_publish style="display:none"><span class="mt5 oh radius-2px">\u786e\u8ba4</span></div></td></tr></table></div></div><div class="topic-list-wrap"><div><ul class="data_topic-list" data_custom_topic></ul><ul class="topic-list pb15"></ul></div></div></div>';e.$el.append(a(i))},p.events={swiperight:function(){o.get_ua().is_uc||life_show_scrolling||n.back()},"tap .ui-btn-prev-wrap":function(){n.back()},"change [data_to_topic_vaule]":function(){I.val().replace(f,"").length>0?x.$el.find(".btn-confirm").show():x.$el.find(".btn-confirm").hide()},"tap [data_to_publish]":function(){if(0==I.val().replace(f,"").length)return w=l.show({text:"\u81ea\u5b9a\u4e49\u8bdd\u9898\u4e0d\u80fd\u4e3a\u7a7a",type:"info",is_cover:!1,auto_close_time:800}),void 0;if(k&&k.textarea){var e=I.val();_()&&(T=_()),T.splice(0,0,{keyword:e}),T=m(T),T.length>5&&T.pop(),c(T),z=$.val();var i="#"+e+"# ";z+=i,$.val(z),I.blur(),n.back(),I.val(""),x.$el.find(".btn-confirm").hide()}}},p.window_change=function(e){a(e.el).find(".topic-list-wrap").height(window.innerHeight-108)};var h={ajax_load_finish:function(){w.close()},before_refresh:function(){w=l.show({text:"\u6b63\u5728\u52a0\u8f7d",type:"loading",is_cover:!0,append_target:x.$el})}},g=d.Model.extend({defaults:{}}),v=d.Collection.extend({model:g,url:t.ajax_url.get_topic_txt_list,refresh:function(){o.collection_refresh_function.call(this,h)},parse:function(e){return e&&e.result_data.list!==void 0?e.result_data.list:e}}),u=d.View.extend({tagName:"li",className:"",initialize:function(){this.render()},events:{"tap [data_to_title]":function(){if(k&&k.textarea){z=$.val();var e="#"+this.keyword+"# ";z+=e,$.val(z),n.back()}},"hold [data_to_custom_topic]":function(){O?(a(this.el).find("[data_del_btn]").show(),O=!1):(a(this.el).find("[data_del_btn]").hide(),O=!0)},"tap [data_del_btn]":function(){var e=this,i=_();x.$el.find('li [data_to_custom_topic="'+this.keyword+'"]').remove(),console.log(e.keyword),a.each(i,function(a,t){t.keyword==e.keyword&&i.splice(a,1)}),c(i)}},render:function(){var e=this;e.keyword=this.model.keyword;var i='<div class="list-box re" data_to_custom_topic='+e.keyword+'><table border="0" cellspacing="0" cellpadding="0" class="w-100 f12"><tr><td><div class="title f14 color333" data_to_title>#'+e.keyword+'#</div></td><td width="50"><div style="width:40px;height:23px;position:absolute;right:15px;bottom:10px;display:none" class="re" data_del_btn><span class="ui-icon-delete radius-2px"><em class="icon-delete icon-bg-common"></em></span></div></td></tr></table></div>';a(this.el).html(i)}}),b=d.View.extend({tagName:"li",className:"",initialize:function(){this.render()},events:{"tap [data_to_publish_topic]":function(){if(k&&k.textarea){z=$.val();var e="#"+this.keyword+"# ";z+=e,$.val(z),n.back()}}},render:function(){var e=this.model.toJSON();this.keyword=e.keyword,this.desc=e.desc;var i='<div class="list-box" data_to_publish_topic><div class="title f14 color333">#{{keyword}}#</div><p class="color999">{{desc}}</p></div>',a=s.to_html(i,e);this.$el.html(a)}});p.page_before_show=function(){_()&&(T=_(),r(T))};var w,y,x,k,$,z,j,C,I,T=[],O=!0;p.page_init=function(t,n,d){var o=a(t.el).find("header"),s=e("page_back_btn")();o.prepend(s.$el),I=t.$el.find("[data_to_topic_vaule]"),C=window.innerHeight-108;var l=a(t.el).find(".topic-list-wrap"),r=e("scroll");j=r.new_scroll(l,{view_height:C}),x=t,k=d,$=k.textarea,y=new v,y.bind("reset",i,t),y.refresh()};var S=e("page").new_page(p);return S}}),"function"==typeof process_add&&process_add();