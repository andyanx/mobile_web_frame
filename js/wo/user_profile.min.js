define("wo/user_profile",["base_package","frame_package","btn_package","commom_function","wo_config","get_template","new_alert_v2","show_big_img","world_list_module","select_module","popup","interact_module","app_function"],function(e,i){var t=e("zepto"),a=e("page_control"),n=e("backbone"),o=e("commom_function"),d=e("mustache"),s=e("wo_config"),l=e("new_alert_v2"),r=e("show_big_img"),c=e("iScroll");e("ua");var _=e("popup"),m=e("app_function");i.route={"user_profile/:query(/from_:source)":"user_profile"},i.new_page_entity=function(){function i(i){h.$el.find("[data-child_container]").hide();var n=h.$el.find("[data-child_container='"+i+"']");switch(i){case"photos":g.trigger_scrollend(),n.show();var d=e("world_list_module")();if(!y){var r=w[0];y=new d({url:s.ajax_url.get_user_photos_profile_achievement,data:{user_id:r,type:i,user_info_tag:z},list_type:"both",no_more_control:!0,main_container:t(h.el).find(".world_list_mvc_warp"),page_view:h.$el.find(".wrap-box"),append_html:'<div class="pics_count" style="display:none"><span data-pics_count=""></span>\u4e2a\u7cbe\u5f69\u77ac\u95f4</div>',onloading:function(){k=l.show({text:"\u52a0\u8f7d\u4e2d",type:"loading",is_cover:!1,append_target:h.$el,auto_close_time:!1})},onreset:function(){g.scroll_to(0),h.$el&&h.$el.find("header").animate({translate3d:"0px, 0px, 0px"},0,"ease-in"),z=0,o.page_pv_stat_action()},onlisttypechange:function(){g.trigger_scrollend()},parse:function(e){if(0==e.is_exist_user)return l.show({text:"\u7528\u6237\u4e0d\u5b58\u5728",type:"info",auto_close_time:2e3,is_cover:!0,closed_callback:function(){a.back()}}),!1;if(z&&(h.$el.find("[data-user_top_info]").html(""),Z=new E({model:e.user_top_info}),Z.show(),h.$el.find("[data-user_top_info]").html(Z.$el)),u.find(".ui-btn-letter").show(),u.find(".act-data li").css("width","33.3%"),u.find("[user_info_item]").show(),u.find(".main_wraper").show(),!o.is_empty(e.photo_list)){console.log(e.photo_list);var i=e.photo_list[0].art_id;0==i&&page_view.$el.find(".platform_tips").show(),e.photo_list.length>=20?(J=!0,"photos"==U&&u.find(".check_more").show()):J=!1,e.item_count>0&&(u.find(".pics_count").show(),u.find("[data-pics_count]").html(e.item_count))}return k.close(),e.photo_list}}),y.start_reset()}break;case"profile":z=0,L?n.show():(g.scroll_to(0),k=l.show({text:"\u52a0\u8f7d\u4e2d",type:"loading",is_cover:!1,append_target:h.$el,auto_close_time:!1}),p(i,{success:function(e){k.close(),n.html(""),x=0,L=new P({model:e.user_bottom_info}),n.append(L.$el),n.show()},error:function(){k.close(),L=null}}));break;case"achievement":z=0,n.show(),M||(console.log("new user_achievement_view_obj"),k=l.show({text:"\u52a0\u8f7d\u4e2d",type:"loading",is_cover:!1,append_target:h.$el,auto_close_time:!1}),p(i,{success:function(e){k.close(),n.html(""),M=new W({model:e.user_bottom_info}),n.append(M.$el)},error:function(){k.close(),M=null}}))}h.$el.find("[data_select_type]").removeClass("cur"),h.$el.find('[data_select_type="'+i+'"]').addClass("cur")}function p(e,i){var i=i||{};success=i.success||function(){},error=i.error||function(){},data=i.data||{},e=e;var a=w[0],n=t.extend(data,{t:parseInt((new Date).getTime()),user_id:a,type:e,user_info_tag:z});o.send_request({url:s.ajax_url.get_user_photos_profile_achievement,data:n,callback:function(e){"function"==typeof success&&success.call(this,e)},error:function(){"function"==typeof error&&error.call(this)}})}function f(e){var i='<div id="popup_container" style="position: absolute; top: 0px; z-index: 100000; left: 0px; width: 100%; height: 100%;background:rgba(0,0,0,0.5);display: table;"><div style="display:table-cell;vertical-align: middle;text-align: center;"><div class="radius-2px f14" style="width: 300px;background: #fff;margin: 0 auto;padding-top:25px;padding-bottom: 20px;"><div class="font_wryh" style=" width: 260px; margin: 0 auto; text-align: center; ">'+e+'</div><div class="clearfix" style=" width: 260px; margin: 30px auto 0 auto; text-align: left; "><div data-close-pop style="width:100%;"><span class="radius-2px save_btn" style=" width: 105px; height: 40px;margin:0 auto">\u6211\u77e5\u9053\u4e86</span></div></div></div></div></div>';S=_.show_popup({container:u,html_str:i})}var h,g,u,v,b,w,y,x=0;o.get_local_poco_id();var k,$,z=1,j={title:"\u4e2a\u4eba\u4e3b\u9875",route:{"user_profile/:query":"user_profile"},transition_type:"slide",dom_not_cache:!0,ignore_exist:!0};j.initialize=function(){this.render()},j.render=function(){var i=e("get_template"),a=i.template_obj(),n=a.user_profile;this.$el.append(t(n))},j.page_hide=function(){D.hide()};var C=!1;j.events={swiperight:function(){o.get_ua().is_uc||C||a.back()},"tap .ui-btn-prev-wrap":function(){a.back()},"tap [data-to_user_photo]":function(){var e=w[0];a.navigate_to_page("#user_photo/"+e)},"tap [data-user_list]":function(){if(a.page_transit_status())return!1;if(h.page_lock)return!1;var e=u.find("[user_name]").html(),i={nick_name:e},t=w[0];a.navigate_to_pae(tap_tag+"/"+t,i)},"tap [data-show_big_img]":function(e){if(a.page_transit_status())return!1;if(h.page_lock)return!1;var i=t(e.currentTarget).find("img"),n=/_\d+./g,o=i.attr("src").replace(n,".");r.show({append_target:u,img_url:o});var d="http://imgtj.poco.cn/pocotj_touch.css?url=touch://mpoco/mobile/check_user_big_icon?tmp="+parseInt((new Date).getTime()),s=new Image;s.src=d},"tap [data_select_type]":function(e){if(U=t(e.currentTarget).attr("data_select_type"),t(e.currentTarget).hasClass("cur"))switch(U){case"photos":y.start_reset();break;case"profile":L=null;break;case"achievement":M=null}i(U)},"tap [data-to_doorplate_list]":function(){if(a.page_transit_status())return!1;if(u.page_lock)return!1;var e=w[0],i=u.find("[user_name]").html();a.navigate_to_page("doorplate_list/"+e,{nick_name:i})},"tap .ui-btn-letter":function(){D.show()},"tap [data-doorplate_last]":function(e){var i=t(e.currentTarget),n=i.attr("data-doorplate_last"),o=w[0];a.navigate_to_page("doorplate_last/"+n+"/"+o)},"tap [data-charm_rank_des]":function(){f("\u6536\u5230\u793c\u7269\uff0c\u83b7\u5f97\u559c\u6b22\u548c\u7c89\u4e1d\uff0c\u90fd\u80fd\u63d0\u5347\u9b45\u529b\u503c")},"tap [data-expense_rank]":function(){f("\u9001\u793c\u7269\u7ed9\u597d\u53cb\uff0c\u63d0\u5347\u8d22\u5bcc\u503c")},"tap [data-close-pop]":function(){S.close()}},j.window_change=function(e){if(t(e.el).find(".main_wraper").height(o.container_height_with_head()),t(e.el).find(".waterfall-item img").css({height:"auto"}),t(e.el).find("[data-doorplate_last]").length>0){var i=M.set_img_size().dooplate_width,a=M.set_img_size().dooplate_height;t(e.el).find("[data-doorplate_last]").last().width()!=i&&t(e.el).find("[data-doorplate_last]").css({width:i+"px",height:a+"px"})}t(e.el).find("[data-cat_conf_id]").length>0&&L.set_category_list_width()};var I,q,T,O,S,N,D,V,E=n.View.extend({initialize:function(e){var i=this;i.render(),i.hide()},render:function(){var i=this.model;if(o.is_empty(i.top_img_url)||(i.top_img_url=o.matching_img_size(i.top_img_url,"m")),this.location_province=i.location_province,this.location_city=i.location_city,this.sex=i.sex,this.username=i.nickname,this.user_icon=i.user_icon,i.location_name=this.location_province==this.location_city?this.location_city:o.is_empty(this.location_city)?this.location_province:this.location_province+"\u00b7"+this.location_city,this.user_icon)var a='<img src="{{user_icon}}">';var n='<div class="user-top-item bgcfff pb15"><div class="user-top-box re"><div class="bg-img" style="background-image: url({{top_img_url}});"></div><div class="user-pic oh" data-show_big_img><table border="0" cellspacing="0" cellpadding="0" style="margin:auto;height:100%;"><tr><td valign="middle" align="center"><div class="pic-box bgcfff">'+a+'</div></td></tr></table></div><div class="user-info lh18 colorfff"><div class="clearfix"><p class="f14 fl fb oh" style="max-width:88%;height:18px" user_name>{{nickname}}</p><em class="sex_icon fl icon-bg-common"></em></div><p class="f10">{{location_name}}</p></div><div class="pay-attention-box"></div></div><table border="0" cellspacing="0" cellpadding="0" class="charm-wealth-tab w-100 f10 mt10 color333"><tbody><tr><td width="50%" data-charm_rank_des><div class="radius-box dib charm-box mr5 f10 lh20 re"><p>\u9b45\u529b\uff1aLV{{charm_rank}}</p><em class="icon icon-bg-common"></em></div></td><td width="50%" data-expense_rank><div class="radius-box dib wealth-box ml5 f10 lh20 re mr5"><p>\u8d22\u5bcc\uff1aLV{{expense_rank}}</p><em class="icon icon-bg-common"></em></div></td></tr></tbody></table><div class="color666 lh16 ml15 mr15 mt20">{{blog_descrit}}</div></div>',s=d.to_html(n,i);t(this.el).html(s),"\u7537"==this.sex?t(this.el).find(".sex_icon").addClass("icon-male"):"\u5973"==this.sex&&t(this.el).find(".sex_icon").addClass("icon-female"),o.get_local_poco_id();var l={};b&&(l=b.follow_btn_obj);var r=w[0];new_follow_btn=e("follow_btn")(),v=new new_follow_btn({status:i.follow_status,user_id:r,other_follow_btn:l,click_callback:function(e){T=e.follow_status,R=!0}}),t(this.el).find(".pay-attention-box").html(""),t(this.el).find(".pay-attention-box").html(v.$el)},show:function(){t(this.el).show()},hide:function(){t(this.el).hide()},get_user_info:function(){return console.log(this.username),{user_name:this.username,user_icon:this.user_icon}}}),P=n.View.extend({initialize:function(e){var i=this;i.render()},events:{"tap [data-user_list]":function(e){if(a.page_transit_status())return!1;if(h.page_lock)return!1;var i=t(e.currentTarget).find(".num").html(),n=u.find("[user_name]").html(),o=t(e.currentTarget).attr("data-user_list"),d=w[0];O==d&&(n="\u6211");var s={num:i,nick_name:n};a.navigate_to_page(o+"/"+d,s)},"tap [data-cat_conf]":function(e){var i=t(e.currentTarget),n=i.attr("data-art_id"),o=i.attr("data-cover_img_url_width"),d=i.attr("data-cover_img_url_height");a.navigate_to_page("last/"+n,{cover_img_width:o,cover_img_height:d})}},render:function(){var e=this.model;this.astro_name=e.astro_name,this.location_province=e.location_province,this.location_city=e.location_city,this.tags_arr=e.tags_arr,this.follow_count=e.follow_count,this.fans_count=e.fans_count,e.location_name=this.location_province==this.location_city?this.location_city:o.is_empty(this.location_city)?this.location_province:this.location_province+"\u00b7"+this.location_city,e.is_exsit_location_name=o.is_empty(e.location_name)?0:1,e.is_exsit_astro_name=o.is_empty(e.astro_name)?0:1,e.is_exsit_tags=o.is_empty(this.tags_arr)?0:1;var i='<div class="data-page pl10 pr10" style="padding-bottom:20px"><div class="basic-info-item mb15"><div class="bgcfff border-item color333 p10 mt10 bdb-line" data-categroy style="display:none"><div class="mb10">TA\u7684\u805a\u5149\u7247</div><div class="category_list_container"><div data-category_list></div></div></div><div class="title color999 mb10 mt15">\u57fa\u672c\u8d44\u6599</div><div class="bgcfff basic-info-box border-item color333 bdb-line">{{#is_exsit_location_name}}<div class="item bdb-line-e6e p15" data-location-item><table border="0" cellspacing="0" cellpadding="0" class="w-100 f12"><tbody><tr><td>\u5730\u533a</td><td align="right" data-location_name="">{{location_name}}</td></tr></tbody></table></div>{{/is_exsit_location_name}}{{#is_exsit_astro_name}}<div class="item bdb-line-e6e p15" data-astro-item><table border="0" cellspacing="0" cellpadding="0" class="w-100 f12"><tbody><tr><td>\u661f\u5ea7</td><td align="right"><span data_astro_name="">{{astro_name}}</span></td></tr></tbody></table></div>{{/is_exsit_astro_name}}{{#is_exsit_tags}}<div class="item bdb-line-e6e p15" data-tags-item><table border="0" cellspacing="0" cellpadding="0" class="w-100 f12"><tbody><tr><td colspan="2">\u6807\u7b7e\uff1a<div class="tag_container"></div></td></tr></tbody></table></div>{{/is_exsit_tags}}</div></div><div class="ta-friend-item"><div class="title color999 mb10">Ta\u7684\u670b\u53cb\u4eec</div><div class="bgcfff ta-friend-box border-item color333 bdb-line"><div class="item bdb-line-e6e p15" data-user_list="fans"><table border="0" cellspacing="0" cellpadding="0" class="w-100 f12"><tbody><tr><td>\u7c89\u4e1d</td><td align="right"><div class="clearfix"><em class="icon-go icon-bg-common fr ml10"></em><span class="font-arial fr num" data-user_info="" data-fans-num="">{{fans_count}}</span></div></td></tr></tbody></table></div><div class="item bdb-line-e6e p15" data-user_list="follow"><table border="0" cellspacing="0" cellpadding="0" class="w-100 f12"><tbody><tr><td>\u5173\u6ce8</td><td align="right"><div class="clearfix"><em class="icon-go icon-bg-common fr ml10"></em><span class="font-arial fr num" data-user_info="" data-follow-num="">{{follow_count}}</span></div></td></tr></tbody></table></div></div></div></div>',a=d.to_html(i,e);if(t(this.el).html(a),console.log(e.img_category.length>0),e.img_category.length>0&&this.render_category_list(e),!o.is_empty(this.tags_arr)){console.log(this.tags_arr);var n='{{#tags_arr}}<span class="tag_text radius-2px">{{tag_txt}}</span>{{/tags_arr}}',s=d.to_html(n,e);t(this.el).find(".tag_container").html(s)}},show:function(){t(this.el).show()},hide:function(){t(this.el).hide()},render_category_list:function(e){for(var i=this,t='{{#img_category}}<div data-art_id="{{art_id}}" data-cover_img_url_width="{{cover_img_url_width}}" data-cover_img_url_height="{{cover_img_url_height}}" data-cat_conf="{{cat_conf_id}}" class="grid_box_container" style="width:'+$+"px;height:"+$+'px" ><img class="my_life_img" src="{{cover_img_url}}" style="display:none"></div>{{/img_category}}',a=0;e.img_category.length>a;a++){var n=e.img_category[a].cover_img_url;n&&(e.img_category[a].cover_img_url=o.matching_img_size(n,"ss"),x++)}var s=d.to_html(t,e);i.$el.find("[data-category_list]").html(s),i.set_category_list_width();var l=i.$el.find(".category_list_container");l.css({position:"relative"}),new c(l[0],{checkDOMChanges:!0,bounce:!1,hScroll:!0,vScroll:!1,hScrollbar:!1,vScrollbar:!1,onScrollStart:function(){C=!0},onScrollEnd:function(){C=!1,console.log(C)}}),i.$el.find("[data-categroy]").show(),setTimeout(function(){i.$el.find(".my_life_img").show()},300)},set_category_list_width:function(){var e=this,i=e.$el.find("[data-category_list]"),t=e.$el.find(".grid_box_container");$=parseInt(16*(window.innerWidth-55-2)/53),t.height($).width($),i.height($),i.width($*x+5*x-5),console.log($,$*x+5*x-5)}}),W=n.View.extend({initialize:function(e){var i=this;i.render()},render:function(){var e=this,i=e.img_size_sort(this.model),a='<div class="gains-item color333 pt10 pb20"><div class="rank-item bgcfff mb10 p15 border-item bdb-line"><div class="clearfix"><div class="charm-box fl" data-charm_rank_des><div class="charm-box-bdr pr15"><div class="title">\u9b45\u529b\u7b49\u7ea7</div><table border="0" cellspacing="0" cellpadding="0" class="mt20 w-100 f12"><tr><td valign="top" width="30"><em class="icon icon-bg-common"></em></td><td><h4 class="fwn"><span class="font-arial">LV<span>{{charm_rank}}</span></span> {{charm_rank_name}}</h4><div class="progress_grade_container mt5 radius-2px"><div class="progress_grade_val re radius-2px" data-charm_rank_progress style="width:0"></div></div><p class="font-arial f10 mt5"><span>{{charm_value}}</span><span class="color999">/{{next_charm_value}}</span></p></td></tr></table></div></div><div class="wealth-box fl" data-expense_rank><div class="pl15"><div class="title">\u8d22\u5bcc\u7b49\u7ea7</div><table border="0" cellspacing="0" cellpadding="0" class="mt20 w-100 f12"><tr><td valign="top" width="30"><em class="icon icon-bg-common"></em></td><td><h4 class="fwn"><span class="font-arial">LV<span>{{expense_rank}}</span></span> {{expense_rank_name}}</h4><div class="progress_grade_container mt5 radius-2px"><div class="progress_grade_val re radius-2px" data-expense_rank_progress style="width:0"></div></div><p class="font-arial f10 mt5"><span>{{expense_value}}</span><span class="color999">/{{next_expense_value}}</span></p></td></tr></table></div></div></div></div>{{#medal_count}}<div class="doorplate-item bgcfff mb10 border-item bdb-line"><div class="title-box bdb-line-e6e pl15 pr15 clearfix"><div class="title fl">\u95e8\u724c</div><div class="fr" data-to_doorplate_list><em class="icon-go icon-bg-common fr"></em><div class="fr mr10"><span class="font-arial">{{medal_count}}</span>\u679a</div></div></div><div class="doorplate-list pt10 pl10 pr10" ><ul class="clearfix">{{#medal_list}}<li class="fl mb10" data-doorplate_last="{{medal_id}}" style="width:{{dooplate_width}}px;height:{{dooplate_height}}px"><div data-doorplate class="img_container_div w-100" style="display:inline-block"><img src="{{medium_photo}}" class="w-100"></div></li>{{/medal_list}}</ul></div></div>{{/medal_count}}<div class="gift-item bgcfff border-item bdb-line" style="display:none"><div class="title-box bdb-line-e6e pl15 pr15 clearfix"><div class="title fl">\u793c\u7269</div><div class="fr" data-to_gift_list><div class="fr mr10"><span class="font-arial">{{gift_count}}</span>\u4ef6</div></div></div><div class="gift-list"><ul class="clearfix">{{#gift_list}}<li data-to_gift_last="{{gift_id}}" class="fl"><div class="div-tab p5 mt5 mb5 ml10"><table border="0" cellspacing="0" cellpadding="0" class="w-100 f12"><tr><td width="60"><div class="gift-img"><img src="{{img_url}}" class="w-100"></div></td><td style="margin-left:10px" data-gift_txt><p>{{name}}</p><p><span class="font-arial fb num">{{count}}</span>\u4efd</p></td></tr></table></div><em class="btm_bg ml10 mr10"></em></li>{{/gift_list}}</ul></div></div></div>',n=d.to_html(a,i);t(this.el).html(n),e.show_progress(t(this.el).find("[data-charm_rank_progress]"),{cur_lv:i.charm_value,total_lv:i.next_charm_value}),e.show_progress(t(this.el).find("[data-expense_rank_progress]"),{cur_lv:i.expense_value,total_lv:i.next_expense_value}),0==i.gift_list.length%2&&e.$el.find("[data-to_gift_last]").eq(-2).find(".btm_bg").addClass("no_btm_bg"),e.$el.find("[data-to_gift_last]").last().find(".btm_bg").addClass("no_btm_bg"),0!=i.gift_list.length&&e.$el.find(".gift-item").show()},show:function(){t(this.el).show()},hide:function(){t(this.el).hide()},img_size_sort:function(e){return 0==e.medal_count?e:(e.dooplate_width=this.set_img_size().dooplate_width,e.dooplate_height=this.set_img_size().dooplate_height,e)},set_img_size:function(){var e=window.innerWidth-2,i=parseInt((e-60)/3);return{dooplate_width:i,dooplate_height:parseInt(i*(52/85))}},show_progress:function(e,i){var i=i||{},t=parseInt(i.cur_lv)||0,a=parseInt(i.total_lv)||500,n=(i.speed||100,i.callback||function(){},null==i.aninmate?!0:!1);if(!(t>a)){var o=e,d=0;if(n){var s=parseInt(100*(t/a));setTimeout(function(){o.animate({width:s+"%"},300,"ease")},300)}else d=parseInt(100*(t/a)),o.css("width",d+"%")}}}),U="photos",J=!1,R=!1,L=null,M=null,Z=null;j.page_init=function(a,n,d){h=a,b=d,w=n,O=o.get_local_poco_id(),I=w[1],u=t(a.el),u.find(".platform_tips").hide();var s=t(a.el).find(".main_wraper"),l=e("scroll");if(g=l.new_scroll(s,{view_height:o.container_height_with_head(),use_lazyload:!0}),N=e("interact_module"),V=w[0],m.can_app_share())var r=!0,c=!0;else var r=!1,c=!1;D=new N({show_share_btn_list:r,gift_btn_obj:{show:!0,click_btn_callback:function(){this.give_gift_action(V)}},message_btn_obj:{show:!0,click_btn_callback:function(){this.control_nav_to_message_list(V)}},share_btn_obj:{show:r,show_share_btn_list:{sina:!0,qqweibo:!0,qqzone:!0,weixin:c},click_btn_callback:function(){},share_btn_list_click_callback:function(e){var i=Z.get_user_info().user_icon.replace("-c","");"weixin"==e&&(i=o.matching_img_size(i,"ms"));var t="\u5206\u4eab\u4e86 "+Z.get_user_info().user_name+" \u7684\u4e2a\u4eba\u4e3b\u9875\uff0c\uff08\u6765\u81ea #POCO\u4e16\u754c# \u624b\u673a\u62cd\u7167\u793e\u533a\uff09 ",a="http://wo.poco.cn/world_share.php?share_page=user_profile&user_id="+V;console.log(i),m.can_app_share()?m.app_share(e,i,t,a):this.share_img(e,i,t,a)}}}),h.$el.find(".wrap-box").append(D.$el);var _=t(a.el).find("header"),p=e("page_back_btn")();_.prepend(p.$el);var f=n[0];100100==f&&u.find(".act-data").hide(),u.find(".check_more").hide(),q=u.find("[data-pop-personal]"),i("photos")};var H=e("page").new_page(j);return H}}),"function"==typeof process_add&&process_add();