define("wo/setup",["base_package","frame_package","btn_package","commom_function","wo_config","get_template","footer_view","new_alert_v2"],function(e,i){var a=e("zepto"),t=e("page_control"),n=e("backbone"),d=e("commom_function"),o=e("wo_config"),s=e("new_alert_v2");i.route={setup:"setup"},i.new_page_entity=function(){function i(e){var e=e.attributes,i=(e.is_bind_sina,e.is_bind_qq,e.is_sina_over_time,e.like_feed_is_show),a=p.find("[data-poco_id]"),t=p.find("[data-open_like_photo]");l(t,i);var n=d.get_local_poco_id();a.html("("+n+")"),c(e)}function l(e,i,a,t){var n=e.find(".select_tag"),d='<em class="icon icon-bg-common"></em>';1==i?(n.removeClass("icon-no-select"),n.addClass("icon-yi-select"),n.append(d),"function"==typeof a&&a.call(this)):(n.addClass("icon-no-select"),n.removeClass("icon-yi-select"),n.html(""),"function"==typeof t&&t.call(this))}function r(e){var e=e||{},i=e.like_feed_is_show,a={};a={like_feed_is_show:i,is_update:1},d.send_request({url:o.ajax_url.setup,data:a})}function c(e){0==e.is_bind_sina?(p.find("#sina_bind").attr("data-bind",e.is_bind_sina).html("\u672a\u7ed1\u5b9a"),p.find("[data-to_login='sina']").find("[data-arrow]").show()):0==e.is_sina_over_time?(p.find("#sina_bind").attr("data-bind",e.is_sina_over_time).html("\u5df2\u8fc7\u671f").removeClass("update-psw"),p.find("[data-to_login='sina']").find("[data-arrow]").show()):(p.find("#sina_bind").attr("data-bind",e.is_bind_sina).html("\u5df2\u7ed1\u5b9a").addClass("update-psw"),p.find("[data-to_login='sina']").find("[data-arrow]").hide()),0==e.is_bind_qq?(p.find("#qqweibo_bind").attr("data-bind",e.is_bind_qq).html("\u672a\u7ed1\u5b9a"),p.find("[data-to_login='qqweibo']").find("[data-arrow]").show()):(p.find("#qqweibo_bind").attr("data-bind",e.is_bind_qq).html("\u5df2\u7ed1\u5b9a").addClass("update-psw"),p.find("[data-to_login='qqweibo']").find("[data-arrow]").hide())}function _(e){var i="",a="http://m.poco.cn/mobile/action/login_bind.php?is_manage=1&login_tag="+e,n=t.page_history();i=n[n.length-2],i||(i=d.get_target_refresh_url_by_hash_name()),top.location.href=a+"&locate="+encodeURIComponent(i)}var m,p,f={route:{setup:"setup"},transition_type:"slide",dom_not_cache:!0};f.initialize=function(){this.render()},f.render=function(){var i=e("get_template"),t=i.template_obj(),n=t.setup;this.$el.append(a(n))},f.events={"tap .ui-btn-prev-wrap":function(){t.back()},swiperight:function(){d.get_ua().is_uc||t.back()},"tap [data-to_login]":function(e){var i=a(e.currentTarget);1!=i.find("[data-bind]").attr("data-bind")&&_(i.attr("data-to_login"))},"tap [data-open_like_photo]":function(e){var i,t=a(e.currentTarget),n=t.find(".select_tag");n.hasClass("icon-no-select")?(i=1,l(t,i)):(i=0,l(t,i)),r({like_feed_is_show:i})},"tap [data-open_hd_photos]":function(e){var i=a(e.currentTarget),t=i.find(".select_tag");t.hasClass("icon-no-select")?(l(i,1),window.localStorage.setItem("open_hd_photo",1)):(l(i,0),window.localStorage.setItem("open_hd_photo",0))}};var h=n.Model.extend({defaults:{is_bind_sina:"",is_bind_qq:"",is_sina_over_time:""},refresh:function(){p.page_lock=!0;var e=s.show({text:"\u52a0\u8f7d\u4e2d",type:"loading",is_cover:!0,auto_close_time:!1,auto_close_time:o.ajax_timeout,append_target:p});this.fetch({type:"GET",data:{t:parseInt((new Date).getTime())},timeout:o.ajax_timeout,success:function(){p.page_lock=!1,e.close()},error:function(){p.page_lock=!1,e.close()}})},url:o.ajax_url.setup+"?is_update=0"});f.window_change=function(e){a(e.el).find(".main_wraper").height(d.container_height_with_head())},f.page_init=function(n){var o=d.get_local_poco_id();if(0>=o)return s.show({text:"\u5c1a\u672a\u767b\u5f55",type:"info",is_fade:!1,is_cover:!0,auto_close_time:1e3,closed_callback:function(){t.back()}}),!1;p=a(n.el);var r=new h;r.bind("change",i,p),r.refresh();var c=a(n.el).find(".main_wraper"),_=a(n.el).find("header"),f=e("page_back_btn")();_.prepend(f.$el);var g=e("scroll");m=g.new_scroll(c,{view_height:d.container_height_with_head()}),1==window.localStorage.getItem("open_hd_photo")?l(a(n.el).find("[data-open_hd_photos]"),1):l(a(n.el).find("[data-open_hd_photos]"),0)},window.onmessage=function(e){var i=JSON.parse(e.data);200==i.result?(s.show({text:"\u7ed1\u5b9a\u6210\u529f",auto_close_time:1e3,auto_close_time:2e3}),p.find("#sina_over_time").html("\u672a\u8fc7\u671f").css("color","").addClass("yi-txt"),p.find("#sina_bind").attr("data-bind",1)):s.show({text:"\u7ed1\u5b9a\u5931\u8d25,"+i.result,type:"info",auto_close_time:2e3})};var g=e("page").new_page(f);return g}}),"function"==typeof process_add&&process_add();