define("wo/edit",["base_package","frame_package","btn_package","commom_function","wo_config","get_template","footer_view","new_alert_v2","img_process","popup","app_function"],function(e,t){var a=e("zepto"),i=e("cookies"),n=e("page_control"),o=e("backbone"),r=e("commom_function"),s=e("app_function"),l=e("wo_config"),_=e("new_alert_v2"),d=e("img_process"),c=e("popup"),p=e("select_module")();t.route={edit:"edit"},t.new_page_entity=function(){function t(e){var t="http://imgup-s.poco.cn/ultra_upload_service/set_user_icon.php?acao_h=1&t="+Math.random();t+="&member_id="+i.readCookie("member_id")+"&g_session_id="+i.readCookie("g_session_id")+"&pass_hash="+i.readCookie("pass_hash");var a=_.show({text:"\u6b63\u5728\u4e0a\u4f20\uff0c\u8bf7\u7a0d\u540e",type:"loading",append_target:y,is_cover:!0});r.send_request({url:t,type:"POST",data:{user_icon_data_base64:e},callback:function(e){if(0==e.result){var t=e.new_user_icon;y.find(".user-img img").attr("src",t),a.close(!0),_.show({text:"\u4e0a\u4f20\u6210\u529f",is_cover:!1,type:"success",auto_close_time:2e3})}else a.close(!0),_.show({text:"\u4e0a\u4f20\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5",type:"info",is_cover:!1,auto_close_time:2e3})},error:function(){a.close(!0)}})}function f(e){z=new p({options_data:[{key:"\u7537",val:"\u7537"},{key:"\u5973",val:"\u5973"}],default_key:e.user_sex,onchange:function(){var e=this.get_select_data(),t=e.val;if(y.find("[data-sex_value]").val(t),y.find("#tag_id").html(""),"\u7537"==t)var a=I.man;else var a=I.woman;for(var i=0;a.length>i;i++){var n='<span class="tag radius-2px">'+a[i]+"</span>";y.find("#tag_id").append(n)}}});for(var t=(new Date).getFullYear(),a=[],i=t;i>=1950;i--)a.push({key:i,val:i+"\u5e74"});j=new p({options_data:a,default_key:e.birthday_year,onchange:function(){var e=this.get_select_data();y.find("[data-birthday_year_value]").val(e.val),y.find("[data-birthday_year_value]").attr("data_key",e.key)}}),C=new p({options_data:[{key:"1",val:"\u767d\u7f8a\u5ea7"},{key:"2",val:"\u91d1\u725b\u5ea7"},{key:"3",val:"\u53cc\u5b50\u5ea7"},{key:"4",val:"\u5de8\u87f9\u5ea7"},{key:"5",val:"\u72ee\u5b50\u5ea7"},{key:"6",val:"\u5904\u5973\u5ea7"},{key:"7",val:"\u5929\u79e4\u5ea7"},{key:"8",val:"\u5929\u874e\u5ea7"},{key:"9",val:"\u5c04\u624b\u5ea7"},{key:"10",val:"\u9b54\u874e\u5ea7"},{key:"11",val:"\u6c34\u74f6\u5ea7"},{key:"12",val:"\u53cc\u9c7c\u5ea7"}],default_key:e.astro,onchange:function(){var e=this.get_select_data();y.find("[data-astro_value]").val(e.val),y.find("[data-astro_value]").attr("data_key",e.key)}})}function g(e){var e=e.attributes;if(f(e),I=e.interest_tags,T=e.user_sex,k=e.blog_id,y.find(".user-img img").attr("src",e.user_icon),e.nickname?y.find("[data-to_edit='nickname'] .input-class").val(e.nickname):y.find("[data-to_edit='nickname'] .input-class").attr("placeholder","\u5c1a\u672a\u6709\u6635\u79f0"),e.blog_descrit?y.find("[data-to_edit='des'] .input-class").val(e.blog_descrit):y.find("[data-to_edit='des'] .input-class").attr("placeholder","\u5c1a\u672a\u6709\u7b7e\u540d"),""==e.location_province?y.find("[data-location_value]").attr("placeholder","\u70b9\u51fb\u8bbe\u7f6e"):(y.find("[data-location_value]").attr("data-city_id",e.location_id),e.location_province==e.location_city?y.find("[data-location_value]").val(e.location_city):y.find("[data-location_value]").val(e.location_province+" "+e.location_city)),y.find("[data-sex_value]").val(e.user_sex).attr("data_key",e.user_sex),""==e.birthday_year?y.find("[data-birthday_year_value]").val(e.birthday_year).attr("data_key",e.birthday_year):y.find("[data-birthday_year_value]").val(e.birthday_year+"\u5e74").attr("data_key",e.birthday_year),y.find("[data-astro_value]").val(e.astro_name).attr("data_key",e.astro),"\u7537"==e.user_sex)var t=e.interest_tags.man;else if("\u5973"==e.user_sex)var t=e.interest_tags.woman;else var t=e.interest_tags.man;for(var i=e.user_interest.split(","),n=0;t.length>n;n++){if(-1!=a.inArray(t[n],i))var o='<span class="tag radius-2px select">'+t[n]+"</span>";else var o='<span class="tag radius-2px">'+t[n]+"</span>";y.find("#tag_id").append(o)}var r=u(e.nickname,e.user_sex,e.location_id,e.birthday_year,e.astro,e.user_interest,e.blog_descrit);r.is_complete||y.find(".tigs-data-item").show()}function u(e,t,a,i,n,o,s){var l=!0,_=[];return r.is_empty(e)&&(l=!1,_.push(' "\u6635\u79f0" ')),r.is_empty(s)&&(l=!1,_.push(' "\u4e2a\u6027\u7b7e\u540d" ')),r.is_empty(t)&&(l=!1,_.push(' "\u6027\u522b" ')),r.is_empty(a)&&(l=!1,_.push(' "\u5730\u533a" ')),r.is_empty(i)&&(l=!1,_.push(' "\u51fa\u751f\u5e74" ')),r.is_empty(n)&&(l=!1,_.push(' "\u661f\u5ea7" ')),r.is_empty(o)&&(l=!1,_.push(' "\u81ea\u6211\u8bc4\u4ef7" ')),{is_complete:l,not_complete_info:_}}function h(e){var t='<div id="popup_container" style="position: absolute; top: 0px; z-index: 100000; left: 0px; width: 100%; height: 100%;background:rgba(0,0,0,0.5);display: table;"><div style="display:table-cell;vertical-align: middle;text-align: center;"><div class="radius-2px f14" style="width: 300px;background: #fff;margin: 0 auto;padding-top:25px;padding-bottom: 20px;"><div class="font_wryh" style=" width: 260px; margin: 0 auto; text-align: left; ">\u7ee7\u7eed\u8865\u5145'+e+'\uff0c\u5c31\u53ef\u4ee5\u83b7\u5f97\u201c\u5c45\u6c11\u8eab\u4efd\u8bc1\u201d\u95e8\u724c\u4e86\u3002</div> <div class="clearfix" style=" width: 260px; margin: 30px auto 0 auto; text-align: left; "> <div class="ui-btn-close fl" data_to_neglect="" style=" width: 125px;  height: 45px; display: inline-block;"><span class="bgc-fff-e6e radius-2px">\u5ffd\u7565</span></div> <div class="ui-btn-register fl" data_to_continue="" style=" width: 125px; height: 45px; display: inline-block; margin-left: 10px;"><span class="radius-2px"> \u7ee7\u7eed\u8865\u5145</span></div> </div> </div></div></div>';$=c.show_popup({container:y,html_str:t})}function m(){var e=y.find("[data-to_edit='nickname'] .input-class").val(),t=y.find("[data-to_edit='des'] .input-class").val(),i=y.find("[data-sex_value]").val(),n=y.find("[data-birthday_year_value]").attr("data_key"),o=y.find("[data-astro_value]").attr("data_key"),r=y.find("[data-location_value]").attr("data-city_id"),s=[];y.find(".tag").each(function(e,t){a(t).hasClass("select")&&s.push(a(t).html())});var l=s.join(",");return{nickname:e,des:t,sex:i,birthday_year:n,astro:o,location_id:r,interest_tag:l}}var v={route:{edit:"edit"},transition_type:"slide",dom_not_cache:!0},b=o.Model.extend({defaults:{nickname:"",user_icon:"",blog_descrit:"",user_id:"",user_sex:"",birthday_year:"",astro:""},refresh:function(){y.page_lock=!0;var e=_.show({text:"\u52a0\u8f7d\u4e2d",type:"loading",append_target:y,is_cover:!0,auto_close_time:!1});this.fetch({type:"GET",data:{t:parseInt((new Date).getTime())},timeout:l.ajax_timeout,success:function(){y.page_lock=!1,e.close()},error:function(){y.page_lock=!1,e.close()}})},url:l.ajax_url.get_user_info});v.initialize=function(){this.render()},v.render=function(){var t=e("get_template"),i=t.template_obj(),n=i.edit;this.$el.append(a(n))},v.events={"tap .ui-btn-prev-wrap":function(){n.back()},swiperight:function(){r.get_ua().is_uc||n.back()},'tap [data-to_edit="user_sex"]':function(){z.open()},'tap [data-to_edit="birthday_year"]':function(){j.open()},'tap [data-to_edit="astro_name"]':function(){C.open()},"tap .tag":function(e){var t=a(e.currentTarget);t.hasClass("select")?t.removeClass("select"):t.addClass("select")},"click .btn-close-wrap":function(){y.find(".tigs-data-item").hide()},"tap [data-to_save]":function(){var e=m(),t=e.nickname,a=e.sex,i=e.des,o=e.location_id,s=e.birthday_year,d=e.astro,c=e.interest_tag,p=u(t,a,o,s,d,c,i);if(p.is_complete)r.send_request({url:l.ajax_url.update_user_info,data:{nickname:t,blog_descrit:i,blog_id:k,location_id:o,user_sex:a,birthday_year:s,astro:d,user_interest:c}}),_.show({text:"\u4fee\u6539\u6210\u529f",auto_close_time:2e3}),n.back();else{var f=p.not_complete_info.join("\u548c");h(f)}},"click [data_to_neglect]":function(e){e.stopPropagation(),e.preventDefault(),$.close();var t=m(),a=t.nickname,i=t.sex,o=t.des,s=t.location_id,d=t.birthday_year,c=t.astro,p=t.interest_tag;r.send_request({url:l.ajax_url.update_user_info,data:{nickname:a,blog_descrit:o,blog_id:k,location_id:s,user_sex:i,birthday_year:d,astro:c,user_interest:p}}),_.show({text:"\u4fee\u6539\u6210\u529f",auto_close_time:2e3}),n.back()},"tap [data_to_continue]":function(){$.close()},"tap [data-to_nav_location]":function(){n.navigate_to_page("set_location",{edit_location_obj:y.find("[data-location_value]"),from_edit_page:!0})},"change .user_icon_file":function(e){if(y.page_lock)return!1;var a=e.currentTarget,i=a.files[0];d.start_img_process(i,{max_width:500,max_height:500,type:"image/jpeg"},function(e){t(e)})},"tap .edit-img":function(){s.app_get_picture({width:500,allowEditing:!0},function(e){if("0000"==e.code){var a="data:image/jpeg;base64,"+e.image;t(a)}})}};var w,y,x,k,$;v.page_before_hide=function(){z.close(),j.close(),C.close()},v.page_init=function(t,i,o){var l=r.get_local_poco_id();if(0>=l)return _.show({text:"\u5c1a\u672a\u767b\u5f55",type:"info",is_fade:!1,is_cover:!0,auto_close_time:1e3,closed_callback:function(){n.back()}}),!1;y=a(t.el),y.find('[data-to_edit="nickname"] .input-class')[0].addEventListener("touchstart",function(e){e.stopPropagation()},!1),y.find('[data-to_edit="des"] .input-class')[0].addEventListener("touchstart",function(e){e.stopPropagation()},!1),y.find('.edit-img input[type="file"]')[0].addEventListener("touchstart",function(e){e.stopPropagation()},!1);var c=a(t.el).find(".main_wraper"),p=e("scroll");view_scroll_obj=p.new_scroll(c,{recept_input:!0,view_height:r.container_height_with_head()}),x=o,w=new b,w.bind("change",g,t),w.refresh();var f=a(t.el).find("header"),u=e("page_back_btn")();if(f.prepend(u.$el),s.is_world_app())y.find(".user_icon_form").hide();else{var h=r.get_ua();d.can_web_upload_img()?h.isAndroid&&h.is_uc&&(y.find("[data_edit_header]").html(""),y.find("[data_edit_header]").append(y.find("[data-for_uc]")),y.find("[data-for_uc]").show()):(y.find("[data_edit_header] div").html("\u4f60\u7684\u6d4f\u89c8\u5668\u5c1a\u672a\u652f\u6301\u4e0a\u4f20\u529f\u80fd").css("color","#ccc"),y.find("[arrow_icon]").css("visibility","hidden"),y.find(".user_icon_file").attr("disabled",""))}};var z,j,C,I,T,N=e("page").new_page(v);return N}}),"function"==typeof process_add&&process_add();