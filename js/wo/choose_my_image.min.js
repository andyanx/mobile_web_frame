define("wo/choose_my_image",["base_package","frame_package","btn_package","commom_function","wo_config","get_template","footer_view","new_alert_v2","img_process","popup","select_module"],function(e,t){var a,i=e("zepto"),n=e("page_control"),s=e("backbone"),l=e("commom_function"),o=e("wo_config"),r=e("mustache"),c=e("new_alert_v2");t.route={choose_my_image:"choose_my_image"},t.new_page_entity=function(){function t(e,t){var t=t||0;l.send_request({url:o.ajax_url.update_my_image_box,type:"GET",data:{art_id:e,is_select:t,display_order:V}}),c.show({text:"\u5df2\u9009\u62e9",type:"success",auto_close_time:800})}function d(){I.find(".grid_box").html(""),my_life_grid_collection_obj.each(function(e){if(l.is_empty(e.attributes.cover_img_url))return!1;var t=new C({model:e});I.find(".grid_box").append(t.$el)}),O.scroll_to(0)}function _(e){if(l.is_empty(e.attributes.cover_img_url))return!1;var t=new C({model:e});I.find(".grid_box").append(t.$el)}var p={transition_type:"slide",dom_not_cache:!1},h=parseInt((window.innerWidth-32)/3),f=!1,u=e("select_module")();parseInt((new Date).getFullYear());var m,v=[],g="",b=0,w=0,y=!1;l.send_request({url:o.ajax_url.get_user_article_date,type:"GET",data:{mod:1},callback:function(e){for(var t=e.article_date,a=t.length;a--;)v.push({key:t[a],val:t[a]});v.unshift({key:0,val:"\u4e0d\u9009"}),m=new u({options_data:v,onchange:function(){var e=this.get_select_data();b=parseInt(e.key),I.find("[data-year_txt]").html(e.val),0==b?(I.find("[data-select_month]").hide(),x.reset(),I.find("[data-month_txt]").html("")):I.find("[data-select_month]").show()}})}});var k,x=new u({options_data:[{key:0,val:"\u4e0d\u9009"},{key:1,val:"1\u6708"},{key:2,val:"2\u6708"},{key:3,val:"3\u6708"},{key:4,val:"4\u6708"},{key:5,val:"5\u6708"},{key:6,val:"6\u6708"},{key:7,val:"7\u6708"},{key:8,val:"8\u6708"},{key:9,val:"9\u6708"},{key:10,val:"10\u6708"},{key:11,val:"11\u6708"},{key:12,val:"12\u6708"}],onchange:function(){var e=this.get_select_data();I.find("[data-month_txt]").html(e.val),w=parseInt(e.key)}}),$={ajax_load_finish:function(e,t){f=!1,I.find("[data_page_num]").css("color","#fff"),I.find(".loadding_tips").html("\u6ed1\u52a8\u5230\u5e95\u90e8\u52a0\u8f7d\u4e0b\u4e00\u9875").show(),y=!1,(null==t.list||0==t.list||20>t.list.length)&&(I.find(".loadding_tips").hide(),y=!0),a.close()},before_refresh:function(){f=!0,a=c.show({text:"\u6b63\u5728\u52a0\u8f7d",type:"loading",is_cover:!0,append_target:I}),I.find("[data_page_num]").css("color","#8D8D8D")},before_get_more:function(){f=!0,I.find(".loadding_tips").html("\u6b63\u5728\u52a0\u8f7d...").show()}},j=1,z=s.Collection.extend({url:function(){return o.ajax_url.get_choose_my_image},get_data:function(e){$.data={p:e,search_keyword:g,search_year:b,search_month:w},l.collection_refresh_function.call(this,$)},get_more_item:function(e){$.data={p:e,search_keyword:g,search_year:b,search_month:w},l.collection_get_more_function.call(this,$)},parse:function(e){return e.list}});s.View.extend({tagName:"div",className:"grid_box_container white_container bdb-line",initialize:function(){var e=this;e.render()},events:{tap:function(){n.navigate_to_page("publish",{key_word:k,camera_sharestr:"#"+k+"#"})}},render:function(){var e='<div style="width:'+h+"px;height:"+h+'px"><table class="has_cover_container" cellspacing="0" cellpadding="0" border="0" width="100%" height="100%"><tr><td align="center" valign="middle"><div class="add_container"><div class="add_icon icon-bg-common" style="margin:0"></div></div></td></tr></table></div>';i(this.el).html(e)}});var C=s.View.extend({tagName:"div",className:"grid_box_container",initialize:function(){var e=this;e.render()},events:{tap:function(e){var a=i(e.currentTarget);this.$el.find(".selected");var s=1,l=a.find(".choose_img").attr("src");t(this.art_id,s),N&&N.font_cover_btn&&(N.font_cover_btn.no_img_tag?N.font_cover_btn.reset_item(l,V):N.font_cover_btn.change_font_cover_img(l)),n.back()}},render:function(){var e=this,t=this.model.toJSON();t.cover_img_url=l.matching_img_size(t.cover_img_url,"ss"),e.cover_img_url=t.cover_img_url,e.art_id=parseInt(t.art_id),e.is_exist=t.is_exists;var a='<div style="width:'+h+"px;height:"+h+'px"><div style="width:100%;height:100%" data-art_id="{{art_id}}" class="selected {{#is_exists}}has_selected{{/is_exists}}"  ><div class="selected_icon icon-bg-common"></div></div><img class="choose_img img_buffer_bg" src="{{cover_img_url}}"></div>',n=r.to_html(a,t);i(this.el).html(n)}});p.initialize=function(){this.render()},p.render=function(){var t=e("get_template");t.template_obj();var a='<div class="wrap-box choose_pic_wrap" ><header class="choose_pic_header header font_wryh clearfix"><h3 class="tc"><span class="user_title"><label></label><span style="display: inline-block;overflow: hidden;">\u9009\u62e9<label style="display:inline" data-cat_name></label>\u7167\u7247</span></span></h3><div class="ui-btn-header-wrap ui-btn-click-wrap" data-filter_in=""><div class="ui-btn-header ui-btn-filter ui-btn-click radius-2px"><label class="filter_text tc dib w-100 h-100 f12">\u67e5\u627e</label></div></div></header><div class="content-8 main_wraper"><div class="choose_pic-box-page font_wryh" style="padding-top:60px;"><div style="overflow:hidden;position:relative;z-index: 1;"><div style="-webkit-transform:translateZ(0px);"></div></div><div class="grid_box"></div><div class="loadding_tips pb10" data-loadding_tips="\u6b63\u5728\u52a0\u8f7d..." data-before_load_tips="\u6ed1\u52a8\u5230\u5e95\u90e8\u52a0\u8f7d\u4e0b\u4e00\u9875">\u6ed1\u52a8\u5230\u5e95\u90e8\u52a0\u8f7d\u4e0b\u4e00\u9875</div></div></div></div><div class="wrap-box search_pics" style="display:none"><header class="search_pics_header header font_wryh clearfix"><div style="left: 5px;" data-back_to_list="" class="ui-btn-header-wrap"><div class="ui-btn-header ui-btn-prev radius-2px"><span class="icon icon-arrow icon-bg-common"></span></div></div><h3 class="tc"><span style="display: inline-block;overflow: hidden;">\u67e5\u627e</span></h3><div class="ui-btn-header-wrap ui-btn-click-wra ui-btn-click-empty" data-filter_out="" style="width:72px"><div class="ui-btn-header ui-btn-filter bgc-fff-e6e ui-btn-click radius-2px" style="width:64px"><label class="filter_text tc dib w-100 h-100 f12">\u6e05\u7a7a\u6761\u4ef6</label></div></div></header><div class="content-8 main_wraper"><div class="choose_pic-box-page font_wryh" style="padding-top:60px;"><div style="overflow:hidden;position:relative;z-index: 1;"><div style="-webkit-transform:translateZ(0px);"></div></div><div class="select-box-item"><div class="input-box bgcfff bdb-line"><input data-key_word type="text" class="input-class w-100 pl15 pr15 color999" value="" placeholder="\u8f93\u5165\u5173\u952e\u5b57"></div><div class="select-box bgcfff color666 mt10 bdb-line"><div class="select-year select" data-select_year><table border="0" cellspacing="0" cellpadding="0" class="w-100 f12"><tr><td><div class="year"><span style="display:inline-block">\u9009\u62e9\u5e74\u4efd</span><span data-year_txt class="time_txt" style="display:inline-block;color:#00922d;margin-left:5px"></span></div></td><td width="8"><span class="icon-go icon-bg-common"></span></td></tr></table></div><div class="select-year select" data-select_month style="border-bottom: none;display:none"><table border="0" cellspacing="0" cellpadding="0" class="w-100 f12"><tr><td><div class="day"><span style="display:inline-block">\u9009\u62e9\u6708\u4efd</span><span data-month_txt class="time_txt" style="display:inline-block;color:#00922d;margin-left:5px"></span></div></td><td width="8"><span class="icon-go icon-bg-common"></span></td></tr></table></div></div><div class="btn-search colorfff bdb-line tc mt10 f16" data-search_btn>\u67e5\u627e</div></div></div></div></div>';this.$el.append(i(a))},p.events={"tap .ui-btn-prev-wrap":function(){n.back()},swiperight:function(){l.get_ua().is_uc||n.back()},"tap [data-filter_in]":function(){I.find(".choose_pic_wrap").hide(),I.find(".search_pics").show()},"tap [data-filter_out]":function(){g="",b=0,w=0,m.reset(),x.reset(),I.find("[data-key_word]").val(""),I.find("[data-year_txt]").html(""),I.find("[data-month_txt]").html(""),I.find("[data-select_month]").hide()},"tap [data-back_to_list]":function(){I.find(".choose_pic_wrap").show(),I.find(".search_pics").hide()},"tap [data-select_year]":function(){m.open()},"tap [data-select_month]":function(){x.open(),I.find("[data-month_txt]").html(x.get_select_data().val)},"tap [data-search_btn]":function(){g=encodeURIComponent(I.find("[data-key_word]").val()),j=1,my_life_grid_collection_obj.get_data(1),I.find(".choose_pic_wrap").show(),I.find(".search_pics").hide()}},p.window_change=function(){I.find(".main_wraper").height(l.container_height_with_head()),h=parseInt((window.innerWidth-32)/3),I.find(".grid_box_container").last().width()!=h&&I.find(".grid_box_container").width(h).height(h)},p.page_show=function(e,t,a){N=a,a&&null!=a.display_order&&(V=a.display_order)};var I,O,N,V;p.page_init=function(t,a,n){I=i(t.el),N=n;var s=i(t.el).find(".choose_pic_header"),o=e("page_back_btn")();s.prepend(o.$el);var r=i(t.el).find(".main_wraper"),c=e("scroll");O=c.new_scroll(r,{recept_input:!0,view_height:l.container_height_with_head(),scroll_end:function(e){if(!y){var a=50,n=this,s=Math.abs(n.y),l=i(e).height(),o=i(t.el).find(".choose_pic-box-page").height();s+l+a>=o&&(f||(console.log("trigger"),j++,my_life_grid_collection_obj.get_more_item(j)))}}}),my_life_grid_collection_obj=new z,my_life_grid_collection_obj.bind("reset",d,t),my_life_grid_collection_obj.bind("add",_,t),my_life_grid_collection_obj.get_data(1)};var T=e("page").new_page(p);return T}}),"function"==typeof process_add&&process_add();