define("wo/last",["base_package","frame_package","btn_package","commom_function","wo_config","new_alert_v2","select_module","interact_module","app_function"],function(e,i){var a=e("zepto"),n=e("page_control"),t=e("backbone"),d=e("commom_function"),s=e("wo_config"),o=e("new_alert_v2"),l=e("mustache");e("select_module")();var r=e("app_function");i.route={"last/:art_id(/from_:source)":"last"},i.new_page_entity=function(i){function c(e){if(T)return!1;T=!0;var e=e||0,i=k[0];y.fetch({type:"GET",timeout:s.ajax_timeout,data:{art_id:i,t:parseInt((new Date).getTime()),source:z,user_refresh:e},success:function(){T=!1,x.$el.find(".ui-btn-letter").show(),x.$el.find(".tigs-pic-item img").height(q),r.can_app_share()&&(1!=window.localStorage.getItem("last_page_record")?(x.$el.find(".tigs-pic-item").show(),x.$el.find(".fade-page").show()):v())},error:function(){o.show({text:"\u7f51\u7edc\u4e0d\u7ed9\u529b\uff0c\u5237\u65b0\u8bd5\u8bd5",type:"info",auto_close_time:1e3}),T=!1}})}function m(){if(confirm("\u662f\u5426\u5220\u9664\u8be5\u7167\u7247")){var e=k[0],i=o.show({text:"\u5220\u9664\u4e2d",type:"loading",append_target:x.$el});d.send_request({url:s.ajax_url.del_acticle,data:{art_id:e,t:parseInt((new Date).getTime())},callback:function(e){1==e.ret_code?(i.close(!0),o.show({text:"\u5220\u9664\u6210\u529f",is_cover:!1,type:"success",is_fade:!1,auto_close_time:1e3,closed_callback:function(){$&&$.photo_txt_view&&$.photo_txt_view.length>0&&$.photo_txt_view.hide(),n.back()}})):(i.close(!0),o.show({text:"\u5220\u9664\u5931\u8d25",type:"info",is_cover:!1,auto_close_time:2e3}))},error:function(){i.close(!0),o.show({text:"\u5220\u9664\u5931\u8d25",type:"info",is_cover:!1,auto_close_time:2e3})}})}}function _(){return parseInt((window.innerWidth-50)/3)}function p(e){var e=e||{},i=e.data||{};a.extend(e.data,{t:parseInt((new Date).getTime())}),console.log(i),d.send_request({url:s.ajax_url.manage_action,data:i,callback:function(i){"function"==typeof e.success&&e.success.call(this,i)},error:function(){"function"==typeof e.error&&e.error.call(this)}})}function v(){x.$el.find(".fade-page").hide(),x.$el.find(".tigs-pic-item").hide()}var f,g=e("select_module")(),h=[{key:"\u81ea\u62cd",val:"\u81ea\u62cd"},{key:"\u65c5\u6e38",val:"\u65c5\u6e38"},{key:"\u7f8e\u98df",val:"\u7f8e\u98df"},{key:"\u840c\u5ba0",val:"\u840c\u5ba0"},{key:"\u73a9\u7269",val:"\u73a9\u7269"},{key:"\u6444\u5f71",val:"\u6444\u5f71"},{key:"\u73a9\u4e50",val:"\u73a9\u4e50"},{key:"\u6211\u7684\u57ce\u5e02",val:"\u6211\u7684\u57ce\u5e02"},{key:"\u5fc3\u60c5",val:"\u5fc3\u60c5"}],u=t.Model.extend({defaults:{art_id:"",summary:"",cover_img_url:"",nickname:"",user_icon:"",like_count:"",cmt_count:"",had_like:"",user_id:"",author_self:""},url:s.ajax_url.last}),i=i||{},b={manual_title:!0,transition_type:i.custom_tansition||"slide",without_his:i.without_his,dom_not_cache:!0,ignore_exist:!0};b.initialize=function(){this.render()},b.render=function(){var i=e("get_template"),a=i.template_obj(),n=a.last;this.$el.html(n)},b.events={"tap .ui-btn-prev-wrap":function(){n.back()},swiperight:function(){d.get_ua().is_uc||n.back()},"tap .art-user-info":function(){if(x.page_lock)return!1;var e=y.attributes.user_id;n.navigate_to_page("user_profile/"+e)},"tap [cmt_btn]":function(){if(x.page_lock)return!1;var e=y.attributes.art_id;n.navigate_to_page("cmt/"+e)},"tap [data-del_btn]":function(){m()},"tap .tag-grid":function(e){var i=e.currentTarget,t=a(i).text(),d=encodeURIComponent(t),s=y.attributes.user_id;n.navigate_to_page("user_photo/"+s+"/"+d)},"tap .tag-theme":function(e){var i=e.currentTarget,t=a(i).text(),d=encodeURIComponent(t);n.navigate_to_page("theme_pic_list/"+d)},"tap poco_at":function(e){var i=e.currentTarget,t=a(i).attr("user_id");t>0&&n.navigate_to_page("user_profile/"+t)},"tap .ui-btn-letter":function(){I.show()},"tap .fade-page":function(){v(),window.localStorage.setItem("last_page_record",1)},"tap [data_tigs_close]":function(){v(),window.localStorage.setItem("last_page_record",1)},"tap [love_btn]":function(e){if(x.page_lock)return!1;var i=d.get_local_poco_id();if(d.is_empty(i))return n.navigate_to_page("login"),void 0;var t=e.currentTarget,s=a(t).find("em"),o=x.$el.find("[replace_like_count]"),l=parseInt(o.html());if(s.hasClass("cur")){s.removeClass("cur");var r=0,c=l-1;0>c&&(c=0),0==c&&x.$el.find(".love-box").hide(),o.html(c),$&&$.btn_love_obj&&$.btn_love_obj.removeClass("cur")}else{s.addClass("cur");var r=1;x.$el.find(".love-box").show(),o.html(l+1),$&&$.btn_love_obj&&$.btn_love_obj.addClass("cur")}var m=y.attributes.art_id;d.like_photo_action(m,r,"detail")},"tap [data-sort_btn]":function(){var e="sort",i=k[0],a=new g({options_data:h,onchange:function(){var a=this.get_select_data();if(d.is_empty(a.val))return f=o.show({text:"\u8bf7\u9009\u62e9\u7c7b\u522b",type:"info",auto_close_time:1e3}),void 0;var n=encodeURIComponent(a.val);p({data:{art_id:i,action_type:e,cat_name:n},success:function(){f=o.show({text:"\u5206\u7c7b\u6210\u529f",type:"info",auto_close_time:1e3})}})}});a.open()},"tap [data-push_to_hot_btn]":function(){var e="push_to_hot",i=k[0];p({data:{art_id:i,action_type:e},success:function(e){console.log(e),f=o.show({text:"\u5df2\u63a8\u4e3a\u70ed\u95e8",type:"info",auto_close_time:1e3})}})},"tap [data-reject_pass_btn]":function(){if(confirm("\u786e\u5b9a\u62d2\u7edd\u901a\u8fc7?")){var e="reject_pass",i=k[0];p({data:{art_id:i,action_type:e},success:function(e){console.log(e),f=o.show({text:"\u5df2\u62d2\u7edd",type:"info",auto_close_time:1e3})}})}}},b.window_change=function(e){e.$el.find(".content-10").height(d.container_height_with_head_and_nav()),e.$el.find("[replace_cover_img_url]").css({height:"auto"}),1==window.localStorage.getItem("manage_mode")&&e.$el.find(".manage_btn").width(_());var i=264*window.innerWidth/640;x.$el.find(".tigs-pic-item img").height(i)},b.page_before_show=function(){j&&(document.title=j)};var w,y,x,k,$,z,j,C,I;b.page_init=function(i,n,t){if(x=i,k=n,$=t,x.page_lock=!0,C=e("interact_module"),r.can_app_share())var s=!0,o=!0;else var s=!1,o=!1;if(r.is_world_app())var l=!0;else var l=!1;if(I=new C({show_share_btn_list:s,message_btn_obj:{show:!0,click_btn_callback:function(){this.control_nav_to_message_list(y.attributes.user_id)}},download_btn_obj:{show:l,click_btn_callback:function(){var e=y.attributes.cover_img_url.replace("-c","");PocoWebViewJavascriptBridge.callHandler("PocoWorld.file.download",{imgUrl:e},function(){})}},report_btn_obj:{show:!0,click_btn_callback:function(e){if(e)e.open();else{var i=k[0],e=this.init_report_select_control(i);e.open()}}},refresh_btn_obj:{show:!0,click_btn_callback:function(){c(1)}},share_btn_obj:{show:s,show_share_btn_list:{sina:!0,qqweibo:!0,qqzone:!0,weixin:o},click_btn_callback:function(){},share_btn_list_click_callback:function(e){var i=y.attributes.cover_img_url.replace("-c","");i="weixin"==e?d.matching_img_size(i,"ms"):d.matching_img_size(i,"mb");var a="\u5206\u4eab\u4e86 "+y.attributes.nickname+" \u7684\u7cbe\u5f69\u7167\u7247\uff0c\uff08\u6765\u81ea #POCO\u4e16\u754c# \u624b\u673a\u62cd\u7167\u793e\u533a\uff09 ",n="http://wo.poco.cn/world_share.php?share_page=last&art_id="+y.attributes.art_id;r.can_app_share()?r.app_share(e,i,a,n):this.share_img(e,i,a,n)}}}),i.$el.find(".wrap-box").append(I.$el),t){var m=d.get_last_page_zoom_height_by_zoom_width(t.cover_img_width,t.cover_img_height);i.$el.find("[replace_cover_img_url]").css("height",m)}var p=a(i.el).find(".main_wraper"),v=e("scroll");w=v.new_scroll(p,{view_height:d.container_height_with_head_and_nav()}),1==window.localStorage.getItem("manage_mode")&&(i.$el.find("[data-manage_btn]").show(),i.$el.find(".manage_btn").width(_()));var f=a(i.el).find("header"),g=e("page_back_btn")();f.prepend(g.$el),z=n[1],y=new u,y.bind("change",get_info_finish,i),c()};var T=!1,O=t.View.extend({tagName:"div",className:"border-btm",initialize:function(){var e=this.model;this.user_id=e.user_id,this.cmt_id=e.cmt_id,this.user_name=e.user_name,this.art_id=e.art_id;var i=e.user_sex,n="";"\u7537"==i?n="icon-male":"\u5973"==i&&(n="icon-female");var t='<table border="0" cellspacing="0" cellpadding="0"> <tr  > <td width="35" data-user_profile_anchor ><div class="user-img middle-center" ><img src="{{user_icon}}" class="max-width-height" /></div></td> <td> <div class="user-info" data-reply_btn data-cmt_id={{cmt_id}} style="position: relative;"> <div class="clearfix"><span class="name lh16 fl">{{user_name}}</span><em class="sex_icon icon-bg-common '+n+'"></em></div><p class="txt lh20 mt5 mb5"> {{#reply_user_name}} \u56de\u590d <span class="name">{{reply_user_name}}</span>\uff1a{{/reply_user_name}}{{{content}}}</p> <div class="clearfix mt5"> <time class="time font-arial fl">{{add_time}}</time> <span class="icon icon-bg-common fr"></span> </div> </div>     </td> </tr> </table>',d=l.to_html(t,e);a(this.el).html(d)},events:{"tap [data-user_profile_anchor]":function(){n.navigate_to_page("user_profile/"+this.user_id)},"tap [data-reply_btn]":function(e){var i=e.target.tagName.toLowerCase();if("poco_at"!=i){var a=this.art_id,t=this.cmt_id,d=this.user_name,s={cmt_id:t,nickname:d};n.navigate_to_page("cmt/"+a,s)}}}});get_info_finish=function(e){var i=e.attributes;if(0==i.art_id)return o.show({text:"\u4f5c\u54c1\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u539f\u4f5c\u8005\u5220\u9664",type:"info",is_cover:!0,is_fade:!1,auto_close_time:1e3,closed_callback:function(){n.back()}}),!1;x.page_lock=!1;var t=i.summary,s=d.matching_img_size(i.cover_img_url,"mb"),l=i.user_icon,r=i.nickname,c=i.like_count,m=i.cmt_count,_=i.had_like;i.user_id;var p=i.add_time,v=i.user_sex,f=i.user_tag,g=i.subject_tag,h="";a(g).each(function(e,i){h+='<span class="tag-item tag-theme radius-2px"><i class="icon icon-theme icon-bg-common mr5"></i>'+i.tag+"</span>"});var u="";if(a(f).each(function(e,i){u+='<span class="tag-item tag-grid radius-2px"><i class="icon icon-grid icon-bg-common mr5"></i>'+i.tag+"</span>"}),x.$el.find(".tag-box-wrap").html(""),x.$el.find(".tag-box-wrap").append(h).append(u),x.$el.find(".tag-box-wrap").addClass("empty_hide"),x.$el.find("[replace_summary]").html(t),x.$el.find(".txt-box").addClass("empty_hide"),x.$el.find("[replace_cover_img_url]").attr({src:s,alt:"POCO"}),x.$el.find("[replace_nickname]").html(r),x.$el.find("[replace_user_icon]").attr("src",l),x.$el.find("[replace_add_time]").html(p),j=r+" \u7684\u7167\u7247",document.title=j,c>0&&x.$el.find(".love-box").show(),x.$el.find("[replace_like_count]").html(c),_?x.$el.find("[love_btn] em").addClass("cur"):x.$el.find("[love_btn] em").removeClass("cur"),x.$el.find(".comment-box").show(),0==m)x.$el.find("[have_cmt_container]").hide(),x.$el.find("[no_cmt_container]").show();else{x.$el.find("[have_cmt_container]").show(),x.$el.find("[no_cmt_container]").hide(),x.$el.find("[replace_cmt_count]").html(m),x.$el.find(".list-comment").html("");var b=i.newest_cmt_list;a(b).each(function(e,i){var a=new O({model:i});x.$el.find(".list-comment").append(a.$el)});var w=3;m>w?(x.$el.find("[check_cmt_btn]").show(),x.$el.find("[replace_rest_cmt_count]").html(m-w)):x.$el.find(".border-btm table").last().css("border","none")}"\u5973"==v?x.$el.find(".art-user-info .sex_icon").addClass("icon-female"):"\u7537"==v&&x.$el.find(".art-user-info .sex_icon").addClass("icon-male"),1==i.author_self&&x.$el.find("[data-del_btn]").show()};var q=264*window.innerWidth/640,N=e("page").new_page(b);return N}}),"function"==typeof process_add&&process_add();