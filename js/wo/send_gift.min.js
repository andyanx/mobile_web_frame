define("wo/send_gift",["base_package","page_control","commom_function","wo_config","get_template","footer_view","refresh_btn","scroll","page","page_back_btn"],function(e,i){var a=e("zepto"),t=e("page_control"),n=e("backbone"),d=e("commom_function");e("wo_config");var o=e("mustache"),s=e("new_alert_v2");i.route={"send_gift/:to_user_id":"send_gift"},i.new_page_entity=function(){function i(){gift_list_collection_obj.each(function(e){var i=new f({model:e});r.$el.find(".main_container").append(i.$el)}),l.scroll_to(0)}var l,r,c={transition_type:"slide",dom_not_cache:!0};c.initialize=function(){this.render()},c.render=function(){var e='<div class="wrap-box"><header class="header font_wryh clearfix tc"><h3 class="clearfix" style="display:inline-block;width:100%;text-align:center"><span class="pl20">\u9001\u793c\u7269</span></h3></header><div class="content-10 main_wraper" style="padding: 0 10px;"><div class="mt10 font_wryh pb10" style="position:relative;padding-top:45px;" ><div class="mb10 bdb-line" style="background: #fff; padding: 12px 15px;"><table cellspacing="0" cellpadding="0" style="width:100%;font-size:12px"><tr><td style="vertical-align:top;width:40px"><div style="width: 32px;height: 32px;overflow: hidden;vertical-align: middle;display: table-cell;text-align: center;"><img user_icon style="vertical-align:middle;max-width:100%;max-height:100%;"></div></td><td ><div class="clearfix">\u6211\u62e5\u6709\u7684\u4e16\u754c\u5e01<section class="fr" style="color:#ED412D"><span class="score_value fb font-arial mr5" style="display:inline-block"></span>\u679a</section></div></td></tr></table></div><div class="gift_list main_container"></div></div></div></div>';this.$el.append(a(e))},c.events={"tap .ui-btn-prev-wrap":function(){t.back()},swiperight:function(){d.get_ua().is_uc||t.back()},"tap [data-anchor-wallet]":function(){t.navigate_to_page("my_wallet")}};var _,m={ajax_load_finish:function(){},before_refresh:function(){},before_get_more:function(){}},p=n.Collection.extend({url:"http://m.poco.cn/mobile/action/send_gift_list.php",refresh:function(){d.collection_refresh_function.call(this,m)},parse:function(e){return r.$el.find(".score_value").html(e.user_score),r.$el.find("[user_icon]").attr("src",e.user_icon),e.gift_list}}),f=n.View.extend({initialize:function(){var e=this;e.render()},render:function(){var e=this.model.toJSON();this.is_can_buy=e.is_can_buy,this.gift_id=e.gift_id,this.score_value=e.score_value,e.state_btn=1==e.is_can_buy?"normal_send_stare":"cannot_send_stare";var i='<div class="mb10 bdb-line gift_list_bg" ><table cellspacing="0" cellpadding="0" style="width:100%"><tr><td style="vertical-align:top;width:50px"><img class="list_gift_img" src="{{img_url}}"></td><td style="font-size:12px;color:#666;padding : 0 10px" ><div class="fb" style="color:#333">{{name}}</div><div class="mt10">{{content}}</div></td><td style="width:50px"></td></tr><tr><td>&nbsp;</td><td colspan=2><div class="mt10 pl10 pr10 f12" style="color:#666;">Ta\u7684\u9b45\u529b\uff1a<span style="color:#ED412D;margin-right:20px">+{{charm_value}}</span>\u6211\u7684\u8d22\u5bcc\uff1a<span style="color:#ED412D">+{{score_value}}</span></div></td></tr></table><div class="btn_wraper"><div state_btn class="btn_css {{state_btn}}">{{score_value}}\u5e01</div></div></div>',t=o.to_html(i,e);a(this.el).html(t)},events:{"tap .btn_wraper":function(){var e=this;if(1!=e.have_send){var i=parseInt(r.$el.find(".score_value").html()),a=e.score_value;return a>i?(s.show({text:"\u4e16\u754c\u5e01\u4e0d\u8db3",type:"info",auto_close_time:1e3}),void 0):(1==e.send_confirm?(e.have_send=1,d.send_request({url:"http://m.poco.cn/mobile/action/send_gift.php",data:{gift_id:e.gift_id,to_user_id:_},callback:function(t){1==t.ret?(r.$el.find(".score_value").html(i-a),e.$el.find(".btn_wraper").hide(),s.show({text:"\u8d60\u9001\u6210\u529f",type:"success",auto_close_time:1e3})):s.show({text:"\u8d60\u9001\u5931\u8d25\uff0c\u9519\u8bef\u4ee3\u7801\uff1a"+t.ret,type:"info",auto_close_time:1e3})},error:function(){e.have_send=0}})):1==e.is_can_buy&&(e.$el.find("[state_btn]").html("\u786e\u8ba4"),e.$el.find("[state_btn]").removeClass("normal_send_stare").addClass("confirm_send_stare"),e.send_confirm=1),void 0)}}}});c.page_init=function(n,o){var c=d.get_local_poco_id();if(0>=c)return s.show({text:"\u5c1a\u672a\u767b\u5f55",type:"info",is_fade:!1,is_cover:!0,auto_close_time:1e3,closed_callback:function(){t.back()}}),!1;r=n,_=o[0];var m=a(n.el).find(".main_wraper"),f=e("scroll");l=f.new_scroll(m,{view_height:d.container_height_with_head()});var h=a(n.el).find("header"),g=e("page_back_btn")();h.prepend(g.$el),gift_list_collection_obj=new p,gift_list_collection_obj.bind("reset",i,n),gift_list_collection_obj.refresh()};var h=e("page").new_page(c);return h}}),"function"==typeof process_add&&process_add();