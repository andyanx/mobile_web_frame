define("wo/master_recommend",["base_package","frame_package","btn_package","commom_function","wo_config","get_template","footer_view"],function(e,i){var a=e("zepto"),n=e("page_control"),t=e("backbone"),d=e("commom_function"),o=e("wo_config"),s=e("mustache"),l=e("new_alert_v2");i.route={"master_recommend(/:issue_id)":"master_recommend"},i.new_page_entity=function(i){function r(){O.clear_list(),T.each(function(e){var i=new x({model:e,pic_size:_()});O.add_list_item(i)}),p.scroll_to(0)}function c(e){var i=new x({model:e,pic_size:_()});O.add_list_item(i)}function _(){return parseInt((window.innerWidth-20-50)/4)}function m(e){var i=e.issue_name;f.find("[data-everyday_title]").html(i)}var p,f,v,g=!1,h=!1,i=i||{},u={transition_type:i.custom_tansition||"slide",without_his:i.without_his,dom_not_cache:!0,ignore_exist:!0},b=t.Model.extend({defaults:{}}),w={ajax_load_finish:function(e,i){$.reset(),h=!1,N=i.previous_issue_count,S=i.next_issue_count,N>0&&f.find("[pre_page_btn]").addClass("click"),S>0&&f.find("[next_page_btn]").addClass("click"),m(i)},before_refresh:function(){$.loadding(),f.find("[pre_page_btn]").removeClass("click"),f.find("[next_page_btn]").removeClass("click"),h=!0}},y=t.Collection.extend({model:b,refresh:function(){w.data={},d.collection_refresh_function.call(this,w)},get_more_item:function(){var e=this;w.data={order_ukey:e.models[e.models.length-1].attributes.order_ukey},d.collection_get_more_function.call(this,w)},parse:function(e){return e&&e.result_data!==void 0?(cur_issue_id=e.result_data.current_issue_count,e.result_data.data):e},url:function(){return o.ajax_url.get_everyweek_super_user+"?issue_count="+q}}),x=t.View.extend({className:"border_item bdb-line",tagName:"div",initialize:function(i){var n=this.img_size_sort(this.model.toJSON());n.location_name=n.location_province==n.location_city?n.location_city:d.is_empty(n.location_city)?n.location_province:n.location_province+"\u00b7"+n.location_city;var t='<table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><td width="42" data-nav_userprofile><div class="user-img"><img lazyload_src="{{user_icon}}"></div></td><td data-nav_userprofile data-user_info><div class="clearfix"><div class="user_name fl" data-user_name>{{user_nickname}}</div><i class="sex_icon icon-bg-common fl"></i></div><div class="location_name" data-location_name>{{location_name}}</div></td><td></td><td data-follow_btn_area align="right"></td></tr></table><div class="user_time_and_pic_count" data-user_time_and_pic_count><span class="icon icon-clock icon-bg-common"></span> {{join_days}}\u5929\uff0c{{publish_count}}\u5f20\u7167\u7247</div><p class="des">{{{user_describe}}}</p><div class="like-photo clearfix">{{#custom_data}}<img lazyload_src="{{cover_img_url_ss}}" data-nav_art="{{art_id}}" data-img_width="{{cover_img_url_width}}" data-img_height="{{cover_img_url_height}}" class="img_buffer_bg imgs " style="width:{{pic_size}}px;height:{{pic_size}}px;">{{/custom_data}}</div>';this.options=i;var o={};j&&(o=j.follow_btn_obj),new_follow_btn=e("follow_btn")(),E=new new_follow_btn({status:n.follow_status,user_id:n.user_id,other_follow_btn:o,account_type:"weeky_recommend"}),this.new_follow_btn=E,this.user_id=n.user_id;var l=s.to_html(t,n);a(this.el).html(l),"\u7537"==n.user_sex?(a(this.el).find(".sex_icon").addClass("icon-male"),a(this.el).find(".sex_icon").show()):"\u5973"==n.user_sex&&(a(this.el).find(".sex_icon").addClass("icon-female"),a(this.el).find(".sex_icon").show()),this.new_follow_btn&&(a(this.el).find("[data-follow_btn_area]").html(""),a(this.el).find("[data-follow_btn_area]").html(this.new_follow_btn.$el))},img_size_sort:function(e){for(var i=e.custom_data.length,a=0;i>a;a++){var n=e.custom_data[a];n.cover_img_url_ss=d.matching_img_size(n.cover_img_url,"ss"),n.pic_size=this.options.pic_size}return e},events:{"tap [data-nav_userprofile]":"navigate_to_user","tap [data-nav_art]":"navigate_to_art"},navigate_to_user:function(){if(this.user_id){var e;this.new_follow_btn&&(e=this.new_follow_btn),n.navigate_to_page("user_profile/"+this.user_id,{follow_btn_obj:e})}},navigate_to_art:function(e){var i=a(e.currentTarget).attr("data-nav_art"),t=a(e.currentTarget).attr("data-img_width"),d=a(e.currentTarget).attr("data-img_height");n.navigate_to_page("last/"+i+"/from_profile",{cover_img_width:t,cover_img_height:d})}}),k=t.View.extend({initialize:function(){},add_list_item:function(e){a(this.el).append(e.$el),this.all_user_id.push(e.user_id)},clear_list:function(){a(this.el).html("")},all_user_id:[]});u.initialize=function(){this.render()},u.render=function(){var e='<div class="wrap-box"><header class="header font_wryh clearfix"><h3 class="clearfix" style="display:inline-block;width:100%;text-align:center"><span class="fwb"><label data-everyday_title></label></span></h3></header><div class="content-10 main_wraper" style="padding: 0 10px;"><div class="master_recommend_list font_wryh" style="padding-top:55px;padding-bottom:20px"></div></div><div class="comment-love-mod"><ul class="clearfix"><li pre_page_btn class="pre" style="width:30%"><em class="icon icon-bg-common" style="margin: 0px 15px -4px 0;display:inline-block"></em>\u4e0a\u4e00\u671f</li><li data-follow_all_users style="width:40%"><em class="icon-follow_all_user icon-bg-common" style="display:inline-block"></em>\u5168\u90e8\u5173\u6ce8</li><li class="next" next_page_btn style="width:30%">\u4e0b\u4e00\u671f<em class="icon icon-bg-common" style="margin: 0px 0 -4px 15px;display:inline-block"></em></li></ul></div></div>';this.$el.append(a(e))},u.events={"tap .ui-btn-prev-wrap":function(){n.back()},swiperight:function(){d.get_ua().is_uc||n.back()},"tap .ui-btn-refresh-wrap":function(){return n.page_transit_status()?!1:(T.refresh(),void 0)},"tap [pre_page_btn]":function(e){var i=a(e.currentTarget);return n.page_transit_status()?!1:0>=N||!i.hasClass("click")?!1:(n.navigate_to_page("master_recommend/"+N,{},!0,"slide_reverse"),void 0)},"tap [next_page_btn]":function(e){var i=a(e.currentTarget);return n.page_transit_status()?!1:0>=S||!i.hasClass("click")?!1:(n.navigate_to_page("master_recommend/"+S,{},!0),void 0)},"tap [data-follow_all_users]":function(){if(h)return!1;if(0>=C)return l.show({text:"\u5c1a\u672a\u767b\u5f55",type:"info",is_fade:!1,is_cover:!0,auto_close_time:1e3,closed_callback:function(){n.navigate_to_page("login")}}),!1;if(g)return!1;g=!0,v=l.show({text:"\u6b63\u5728\u5173\u6ce8",type:"loading",is_cover:!0,append_target:f});var e=O.all_user_id.join("||"),i='<span class="data-follow_btn"><span data-is_follow="0" class="ui-icon-item-wrap dib ml20 lh22 tc border-style-d2 f10 radius-2px"><em class="ui-icon-item radius-2px fsn"><i class="icon-atten icon-yi icon-bg-common"></i></em></span></span>';d.send_request({url:o.ajax_url.follow_all_users,data:{user_id:e,t:parseInt((new Date).getTime())},callback:function(){g=!1,f.find("[data-follow_btn_area]").html(i),v.close(),l.show({text:"\u5168\u90e8\u597d\u53cb\u5173\u6ce8\u6210\u529f",type:"info",is_fade:!1,is_cover:!0,auto_close_time:1e3})},error:function(){g=!1,v.close()}})}},u.window_change=function(e){a(e.el).find(".main_wraper").height(d.container_height_with_head_and_nav()),a(e.el).find(".imgs").width(_()).height(_())},u.page_before_show=function(e){a(e.el).find(".main_wraper").height(d.container_height_with_head_and_nav())};var $,z,f,j,C,I,T,O,q,N,S,E=null;u.page_init=function(i,n,t){f=a(i.el),z=n,j=t,C=d.get_local_poco_id(),q=n[0]===void 0?"":n[0],$=e("refresh_btn")(),i.$el.find(".header").append($.$el);var o=a(i.el).find(".main_wraper"),s=e("scroll");p=s.new_scroll(o,{view_height:d.container_height_with_head_and_nav(),use_lazyload:!0});var l=a(i.el).find("header");I=e("page_back_btn")(),l.prepend(I.$el),T=new y,O=new k({el:f.find(".master_recommend_list")}),T.bind("reset",r,i),T.bind("add",c,i),T.refresh()};var P=e("page").new_page(u);return P}});