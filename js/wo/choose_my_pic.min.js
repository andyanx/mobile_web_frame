define("wo/choose_my_pic",["base_package","frame_package","btn_package","commom_function","wo_config","get_template","footer_view","new_alert_v2","img_process","popup"],function(e,t){var i,a=e("zepto"),n=e("page_control"),_=e("backbone"),o=e("commom_function"),l=e("wo_config"),s=e("mustache"),r=e("new_alert_v2");t.route={"choose_my_pic(/:tag_id)":"choose_my_pic"},t.new_page_entity=function(){function t(e,t){var t=t||0;o.send_request({url:l.ajax_url.update_my_life_grid_box,type:"GET",data:{tag_id:$,art_id:e,is_select:t}}),t?r.show({text:"\u5df2\u9009\u62e9",type:"success",auto_close_time:800}):r.show({text:"\u5df2\u53d6\u6d88",type:"success",auto_close_time:800})}function c(e){N=!1;for(var t="",i=0;e>i;i++){var a=i+1;t+='<div class="normal_item_list select_page_container" data-page="'+a+'"><div class="input-box" data-to_selected_page><table border="0" cellspacing="0" cellpadding="0" class="reset_table"><tbody><tr><td style="width: 100%;"><span data-page_num_txt>'+a+"</span></td></tr></tbody></table></div></div>"}j.find(".page_list").html(t)}function d(){if(j.find(".grid_box").html(""),1==f){var e=new w;j.find(".grid_box").append(e.$el)}my_life_grid_collection_obj.each(function(e){if(o.is_empty(e.attributes.cover_img_url))return!1;var t=new k({model:e});j.find(".grid_box").append(t.$el)}),z.scroll_to(0)}var p,g={transition_type:"slide",dom_not_cache:!0},h=parseInt((window.innerWidth-32)/3),m=!1,u={ajax_load_finish:function(){m=!1,j.find("[data_page_num]").css("color","#fff"),i.close()},before_refresh:function(){m=!0,i=r.show({text:"\u6b63\u5728\u52a0\u8f7d",type:"loading",is_cover:!0}),j.find("[data_page_num]").css("color","#8D8D8D"),C.loadding()}},f=1,b=_.Collection.extend({url:function(){return l.ajax_url.get_my_life_pics},get_data:function(e){u.data={tag_id:$,p:e},o.collection_refresh_function.call(this,u)},parse:function(e){return f=e.index_page,p=e.cat_name,j.find("[data_page_num]").html(f),e.can_next_page?C.use_next_btn():C.ban_next_btn(),e.can_pre_page?C.use_pre_btn():C.ban_pre_btn(),e.total_page>1&&c(e.total_page),e.list}}),v=_.View.extend({tagName:"div",className:"comment-love-mod",initialize:function(){var e=this;e.render()},render:function(){var e='<ul class="clearfix"><li pre_page_btn="" class="pre" style="width:40%"><em class="icon icon-bg-common" style="margin: 0px 15px -4px 0;display:inline-block"></em>\u4e0a\u4e00\u9875</li><li data-page_num style="width:20%"><label data_page_num style="font-size:18px">1</label><em class="icon_arrow_down icon-bg-common" style="display:inline-block;vertical-align: 2px;"></em></li><li class="next" next_page_btn="" style="width:40%">\u4e0b\u4e00\u9875<em class="icon icon-bg-common" style="margin: 0px 0 -4px 15px;display:inline-block"></em></li></ul>';a(this.el).html(e)},loadding:function(){a(this.el).find("[next_page_btn]").removeClass("click"),a(this.el).find("[pre_page_btn]").removeClass("click")},reset:function(){this.pre_ban=!1,this.next_ban=!1},use_pre_btn:function(){this.pre_ban=!1,a(this.el).find("[pre_page_btn]").addClass("click")},use_next_btn:function(){this.next_ban=!1,a(this.el).find("[next_page_btn]").addClass("click")},ban_pre_btn:function(){this.pre_ban=!0,a(this.el).find("[pre_page_btn]").removeClass("click")},ban_next_btn:function(){this.next_ban=!0,a(this.el).find("[next_page_btn]").removeClass("click")},get_pre_page_btn_ban_mode:function(){return this.pre_ban},get_next_page_btn_ban_mode:function(){return this.next_ban}}),w=_.View.extend({tagName:"div",className:"grid_box_container white_container bdb-line",initialize:function(){var e=this;e.render()},events:{tap:function(){n.navigate_to_page("publish",{key_word:p,camera_sharestr:"#"+p+"#"})}},render:function(){var e='<div style="width:'+h+"px;height:"+h+'px"><table class="has_cover_container" cellspacing="0" cellpadding="0" border="0" width="100%" height="100%"><tr><td align="center" valign="middle"><div class="add_container"><div class="add_icon icon-bg-common" style="margin:0"></div></div></td></tr></table></div>';a(this.el).html(e)}}),x=0,y=!1,k=_.View.extend({tagName:"div",className:"grid_box_container",initialize:function(){var e=this;e.render()},events:{tap:function(){if(y)return r.show({text:"\u4f60\u64cd\u4f5c\u5f97\u592a\u5feb\u62c9",type:"info",auto_close_time:1e3}),void 0;y=!0;var e=this.$el.find(".selected");if(e.hasClass("has_selected")){var i=0;x--,e.removeClass("has_selected")}else{var i=1;x++,e.addClass("has_selected")}t(this.art_id,i),setTimeout(function(){y=!1},300)}},render:function(){var e=this,t=this.model.toJSON();t.cover_img_url=o.matching_img_size(t.cover_img_url,"ss"),e.cover_img_url=t.cover_img_url,e.art_id=parseInt(t.art_id),e.is_exist=t.is_exist;var i='<div style="width:'+h+"px;height:"+h+'px"><div style="width:100%;height:100%" data-art_id="{{art_id}}" class="selected {{#is_exist}}has_selected{{/is_exist}}"  ><div class="selected_icon icon-bg-common"></div></div><img class="choose_img img_buffer_bg" src="{{cover_img_url}}"></div>',n=s.to_html(i,t);a(this.el).html(n)}});g.initialize=function(){this.render()},g.render=function(){var t=e("get_template");t.template_obj();var i='<div class="wrap-box choose_pic_wrap"><header class="choose_pic_header header font_wryh clearfix"><h3 class="tc"><span class="user_title"><label></label><span style="display: inline-block;overflow: hidden;">\u9009\u62e9<label style="display:inline" data-cat_name></label>\u7167\u7247</span></span></h3></header><div class="content-8 main_wraper"><div class="choose_pic-box-page font_wryh" style="padding-top:60px;"><div style="overflow:hidden;position:relative;z-index: 1;"><div style="-webkit-transform:translateZ(0px);"></div></div><div class="grid_box"></div></div></div></div><div class="wrap-box page_list_wrap" style="display:none"><header class="page_list_header header font_wryh clearfix"><h3 class="tc"><span class="user_title"><div class="ui-btn-header-wrap back_to_box_list" style="left:5px"><div class="ui-btn-header ui-btn-prev radius-2px"><span class="icon icon-arrow icon-bg-common"></span></div></div><span style="display: inline-block;overflow: hidden;">\u9009\u62e9\u9875\u6570</span></span></h3></header><div class="content-8 main_wraper"><div class="page_list_container" ><div class="page_list" style="padding-top:55px;padding-bottom:10px"></div></div></div></div>';this.$el.append(a(i))},g.events={"tap .ui-btn-prev-wrap":function(){n.back()},swiperight:function(){o.get_ua().is_uc||n.back()},"tap [pre_page_btn]":function(){if(C.get_pre_page_btn_ban_mode())return!1;var e=f-1;my_life_grid_collection_obj.get_data(e)},"tap [next_page_btn]":function(){if(C.get_next_page_btn_ban_mode())return!1;var e=f+1;my_life_grid_collection_obj.get_data(e)},"tap [data-page_num]":function(){m||N||(j.find(".page_list_wrap").show(),j.find(".choose_pic_wrap").hide())},"tap .back_to_box_list":function(){m||(j.find(".page_list_wrap").hide(),j.find(".choose_pic_wrap").show())},"tap .select_page_container":function(e){if(!m){var t=a(e.currentTarget).attr("data-page");my_life_grid_collection_obj.get_data(t),j.find(".page_list_wrap").hide(),j.find(".choose_pic_wrap").show()}},"tap .ui-btn-save-wrap":function(){x>0&&r.show({text:"\u5df2\u65b0\u6dfb\u52a0 "+x+" \u5f20\u56fe\u7247",type:"info",auto_close_time:2e3}),n.back()}},g.window_change=function(){j.find(".main_wraper").height(o.container_height_with_head_and_nav()),h=parseInt((window.innerWidth-32)/3),j.find(".grid_box_container").width(h).height(h)};var j,$,C,z;g.page_init=function(t,i,n){j=a(t.el),$=i[0],n&&n.cat_name&&(p=n.cat_name,a(t.el).find("[data-cat_name]").html(p));var _=a(t.el).find("header"),l=e("page_back_btn")();_.prepend(l.$el),C=new v,t.$el.find(".choose_pic_wrap").append(C.$el);var s=a(t.el).find(".main_wraper"),r=e("scroll");z=r.new_scroll(s,{recept_input:!0,view_height:o.container_height_with_head_and_nav()}),r.new_scroll(a(t.el).find(".page_list_container"),{recept_input:!0,view_height:o.container_height_with_head()}),my_life_grid_collection_obj=new b,my_life_grid_collection_obj.bind("reset",d,t),my_life_grid_collection_obj.get_data(1)};var y=!1,N=!0,I=e("page").new_page(g);return I}});