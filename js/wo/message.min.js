define("wo/message",["base_package","frame_package","btn_package","commom_function","wo_config","get_template","notice","message_nav","no_login"],function(e,i){var a=e("zepto"),n=e("page_control"),t=e("backbone"),d=e("commom_function"),s=e("wo_config"),o=e("notice"),l=e("new_alert_v2"),r=e("mustache");i.route={message:"message"},i.new_page_entity=function(){function i(){h.clear_list(),$.each(function(e){var i=new z({model:e});h.add_list_item(i)}),_.scroll_to(0)}function c(e){var i=new z({model:e});h.add_list_item(i)}var _,m,p,f,v,g,h,u,b,w={title:"\u79c1\u4fe1\u901a\u77e5",route:{message:"message"},transition_type:"none"},y=20,x={ajax_load_finish:function(e,i){b.close(),u=!1,I.reset(),a(i).each(function(e,i){1==i.have_unread_before&&(u=!0)}),h.cmt_more_btn_reset(),(0==i||y>i.length)&&!u&&h.hide_more_btn()},before_refresh:function(){h.more_btn_loading(),I.loadding(),b=l.show({text:"\u52a0\u8f7d\u4e2d",type:"loading",is_cover:!1,auto_close_time:!1,append_target:p.$el})},before_get_more:function(){h.more_btn_loading(),I.more_btn_loading()}},k=e("user_list_collection"),$=k({url:s.ajax_url.message_notice,refresh:function(){d.collection_refresh_function.call(this,x)},get_more_item:function(){d.collection_get_more_function.call(this,x)}}),z=t.View.extend({tag:"div",className:"border-btm ",initialize:function(e){var e=e||{};this.model_data=e.model.attributes,this.render()},events:{"tap [td_1]":function(){n.navigate_to_page("user_profile/"+this.model_data.user_id)},"tap [data-nav-to_msg_list]":function(){this.$el.find(".unread_count").hide(),this.$el.hasClass("color999")&&this.$el.removeClass("color999"),n.navigate_to_page("message_list/"+this.model_data.user_id,{state_tag:"from_message",message_user_name:this.model_data.user_name,unread_count:this.model_data.unread_count})}},render:function(){this.model_data.user_icon=d.matching_img_size(this.model_data.user_icon,"ms"),this.has_unread=!1;var e="";"\u7537"==this.model_data.sex?e="icon-male":"\u5973"==this.model_data.sex&&(e="icon-female");var i='<table border="0"cellspacing="0"cellpadding="0"><tr><td valign="top" width="42" td_1><div class="user-img"><img class="radius-2px" src="{{user_icon}}"></div></td><td data-nav-to_msg_list td_2 style="padding-right:10px;"><div class="be-like-item"><div data-td_2_top_content><div class="be-like-user-info clearfix"><span class="fl user-name lh16 color009 mr5" style="margin-bottom: 1px;">{{user_name}}</span><em data-sex_icon class="fl sex_icon icon-bg-common '+e+'"></em></div><div class="message_content {{#is_read}}is_read{{/is_read}} {{^unread_count}}color999{{/unread_count}}">{{{content}}}</div></div></div></td><td data-nav-to_msg_list valign="bottom" width="60" td_3 align="center"><div class="unread_count" style="{{#unread_count}}display:inline-block;{{/unread_count}} margin-bottom: 1px;"><i class="n fsn">{{unread_count}}</i></div><div class="push_time">{{push_time}}</div></td></tr></table>',a=r.to_html(i,this.model_data);this.$el.html(a)}});w.initialize=function(){this.render()},w.render=function(){var i=e("get_template");i.template_obj();var n=e("footer_view");footer_view_obj=new n({cur:"friend"});var t='<div class="wrap-box"><header class="header font_wryh tc re"><div class="tap-select-wrap"><span class="header_title"></span><div class="tab-select re bgc-fff-e2e"><ul class="clearfix" ><li data-select_firend_type="act"><span class="one">\u7167\u7247</span><em class="pop-empty pop-empty-1"></em></li><li class="cur" data-select_firend_type="message"><em class="num circle-oval-item" data-message_num style="display: none;"><i class="middle"><i class="inner"><i class="n font-arial fsn" data-num_html>0</i></i></i></em><span class="two">\u79c1\u4fe1</span><em class="pop-empty pop-empty-2"></em></li></ul></div><div class="ui-btn-header-wrap ui-btn-user-wrap ui-btn-user-wrap-left"><div class="ui-btn-header ui-btn-user radius-2px"><span class="icon icon-user icon-bg-common"></span></div> </div></div></header><div id="noLogin"></div><div class="main_wraper"><div class="inside-page font_wryh" style="padding-top:45px;"><div style="overflow:hidden;position:relative;z-index: 1;"><div style="-webkit-transform:translateZ(0px);"></div></div><div class="main_container pb5"><div class="send_message fixed_scroll_blink" data-send_message_btn=""><div class="re"><i class="icon-message icon-bg-common"></i><span style="display:block;margin-left:21px">\u53d1\u79c1\u4fe1/\u9001\u793c\u7269</span></div></div><div class="list-comment-item list-comment-item-padding0 content-10 "></div></div></div></div><footer class="footer"></footer></div>';this.$el.append(a(t)),this.$el.find(".footer").append(footer_view_obj.$el)},w.events={"tap .ui-btn-prev-wrap":function(){n.back()},"tap .data-more_btn":function(){return n.page_transit_status()?!1:($.get_more_item(),void 0)},"tap [data-send_message_btn]":function(){n.navigate_to_page("get_friends_list/from_message")},"tap .banner_tips":function(e){var i=a(e.currentTarget);i.remove(),window.localStorage.setItem("message_nav_banner_tips",1)},swipeleft:function(){!d.get_ua().is_uc},"tap [data-select_firend_type]":function(e){var i=a(e.currentTarget).attr("data-select_firend_type");"act"==i&&n.navigate_to_page("friend")},"tap .ui-btn-refresh-wrap":function(){return n.page_transit_status()?!1:($.refresh(),d.get_poco_id(function(e){o.reset_notice_by_data(e.notice_stat),o.refresh_message_group_count()},!0),void 0)},"tap .ui-btn-user-wrap":function(){n.navigate_to_page("recommend")}},w.window_change=function(e){a(e.el).find(".main_wraper").height(d.container_height_with_head_and_nav())};var j,C=!0;w.page_before_show=function(e){return a(e.el).find(".main_wraper").height(d.container_height_with_head_and_nav()),footer_view_obj.change_friend_tab_select("message"),1!=window.localStorage.getItem("message_nav_banner_tips")&&0>=p.$el.find(".banner_tips").length?(p.$el.find(".main_container").prepend(d.banner_tips({html_str:"\u518d\u6b21\u70b9\u51fb\u9009\u9879\u5361\u5373\u53ef\u5237\u65b0"})),p.$el.find(".banner_tips").css("margin","10px 10px")):p.$el.find(".banner_tips").remove(),j=d.get_local_poco_id(),0>=j?(g.show(),p.$el.find(".header").hide(),p.$el.find(".main_wraper").hide(),C=!1,!1):(g.hide(),p.$el.find(".main_wraper").show(),p.$el.find(".header").show(),C?(console.log("normal state"),o.refresh_message_group_count(),window.refresh_message?($.refresh(),window.refresh_message=!1):o.get_unread_count_by_type("message")>0&&$.refresh()):(d.get_poco_id(function(e){o.reset_notice_by_data(e.notice_stat),console.log("login just now"),o.refresh_message_group_count(),$.refresh()},!0),C=!0),void 0)};var I,T=e("user_list_controler");w.page_init=function(n,t,s){p=n,m=t,f=s,window.refresh_message=!1,j=d.get_local_poco_id(),v=e("no_login"),g=new v,p.$el.find("#noLogin").append(g.$el),g.hide(),I=e("refresh_btn")(),n.$el.find(".header").append(I.$el);var l=a(n.el).find(".main_wraper");a(n.el).find(".no_login").height(d.container_height_with_head_and_nav());var r=e("scroll");_=r.new_scroll(l,{view_height:d.container_height_with_head_and_nav()}),h=new T({el:a(n.el).find(".list-comment-item")}),h.load_more_btn.$el.addClass("pr10 pl10"),$.bind("reset",i,n),$.bind("add",c,n),j>0&&$.refresh(),o.refresh_message_group_count()};var O=e("page").new_page(w);return O}}),"function"==typeof process_add&&process_add();