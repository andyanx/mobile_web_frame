define("wo/charm_rank",["base_package","frame_package","btn_package","commom_function","wo_config","get_template","rank_nav","select_module","notice"],function(e,t){var a=e("zepto"),i=e("page_control"),n=e("backbone"),s=e("commom_function"),o=e("wo_config"),l=e("new_alert_v2"),r=e("mustache"),_=e("select_module")(),c=e("notice");t.route={"charm_rank(/:time)":"charm_rank"},t.new_page_entity=function(){function t(){s.page_pv_stat_action(),"day"==b?v.clear_list():"week"==b&&g.clear_list(),m.each(function(e){var t=new N({model:e});"day"==b?v.add_list_item(t):"week"==b&&g.add_list_item(t)}),p.scroll_to(0)}function d(e){u.$el.find("[data_select_date]").removeClass("cur"),u.$el.find("[data_select_date="+e+"]").addClass("cur"),"day"==e&&(v.show(),g.hide(),0==u.$el.find("[day_list_charm_rank] .rank_item").length&&m.refresh()),"week"==e&&(g.show(),v.hide(),0==u.$el.find("[week_list_charm_rank] .rank_item").length&&m.refresh())}var p,h,u,f,m,v,g,w,b,y,k,x={title:"\u9b45\u529b\u6392\u884c\u699c",route:{charm_rank:"charm_rank"},transition_type:"slide"},$="",j=[],C=!1,z=!1,O="",I={ajax_load_finish:function(e,t){if(k.close(),z=!1,y>0){if(!w){if(j=t.location.select_list,j.length>0){if(O=t.location.cur_location_key,!C){var a=t.location.cur_location_name;u.$el.find("[data_city_value]").html(a),C=!0}u.$el.find("[data_select_location]").show()}else u.$el.find("[data_select_location]").hide();console.log("new select_module_class"),w=new _({options_data:j,default_key:O,onchange:function(){select_data=this.get_select_data(),$=select_data.key;var e=select_data.val;u.$el.find("[data_city_value]").html(e),v.clear_list(),g.clear_list(),m.refresh()}})}}else w=null,u.$el.find("[data_select_location]").hide()},before_refresh:function(){k=l.show({text:"\u6b63\u5728\u52a0\u8f7d",type:"loading",is_cover:!1,append_target:u.$el}),z=!0}},V=n.Model.extend({defaults:{}}),P=n.Collection.extend({model:V,url:o.ajax_url.get_charm_expense_rank_list,refresh:function(){I.data={date_type:b,rank_type:"charm",location_city:$},s.collection_refresh_function.call(this,I)},parse:function(e){return e&&e.list!==void 0?e.list:e}}),N=n.View.extend({tagName:"ul",className:"rank_item",initialize:function(){this.render()},events:{"tap [data_user_page]":function(){i.navigate_to_page("user_profile/"+this.user_id)}},render:function(){var e=this.model.toJSON();this.rank_value=parseInt(e.rank_value),this.user_rank=parseInt(e.user_rank),this.sort_num=parseInt(e.sort_num),this.user_icon=e.user_icon,this.sex=e.sex,this.user_name=e.user_name,this.user_id=e.user_id,this.order_key=parseInt(e.order_key),this.user_rank_name=e.user_rank_name;var t="",i="";this.order_key>=1&&3>=this.order_key?(t="class_style"+this.order_key,i="icon-bg-common",y==this.user_id&&(t+=" class_self")):this.order_key>3&&y==this.user_id&&(t="class_self");var n='<li class="'+t+'" data_user_page><table border="0" cellspacing="0" cellpadding="0" class="w-100 f12"><tr><td width="50" align="center" style="border-right:1px solid #e1e1e1"><span class="sort_num db '+i+'">{{order_key}}</span></td><td><div class="clearfix pt10 pb10"><div class="fl ml10 mr10"><div class="user-pic middle-center img_buffer_bg"><img lazyload_src={{user_icon}} class="max-width-height"></div></div><div class="txt fl"><div class="clearfix"><span class="name fl color333 lh16 oh">{{user_name}}</span><em class="sex_icon fl icon-bg-common"></em></div><p class="color999">LV<em class="fsn user_rank mr5">{{user_rank}}</em> {{user_rank_name}}</p></div></div></td><td width="50"><span class="rank_value color666 db">+{{rank_value}}</span></td></tr></table></li>',s=r.to_html(n,e);a(this.el).html(s),"\u7537"==this.sex?a(this.el).find(".sex_icon").addClass("icon-male"):"\u5973"==this.sex&&a(this.el).find(".sex_icon").addClass("icon-female")}});x.initialize=function(){this.render()},x.render=function(){var t=e("get_template");t.template_obj();var i='<div class="wrap-box"><header class="header font_wryh fb tc re "><h3 class="tc" >\u9b45\u529b\u699c</h3></header><div class="main_wraper"><div class="inside-page font_wryh" style="padding-top:45px;"><div style="overflow:hidden;position:relative;z-index: 1;"><div style="-webkit-transform:translateZ(0px);"></div></div><div class="main_container"><div class="list-page pl10 pr10"><div class="select-city-data clearfix mt10 color666"><div class="location_city bgcf0f border-style-be re fl radius-2px" data_select_location style="display:none"><span data_city_value class="city fl"></span><em class="fl ml20 icon-change mt5"></em></div><div class="data-list-change fr radius-2px"><ul class="clearfix"><li class="cur" data_select_date="day">\u65e5\u699c</li><li data_select_date="week">\u5468\u699c</li></ul></div></div><div class="list-item pt10 pb15" day_list_charm_rank></div><div class="list-item pt10 pb15" week_list_charm_rank style="display:none"></div></div></div></div></div></div>';this.$el.append(a(i))},x.events={"tap .ui-btn-prev-wrap":function(){i.back()},swiperight:function(){!s.get_ua().is_uc},swipeleft:function(){!s.get_ua().is_uc},"tap [data_select_location]":function(){w.open()},"tap [data_select_date]":function(e){return z?void 0:(b=a(e.currentTarget).attr("data_select_date"),a(e.currentTarget).hasClass("cur")?(m.refresh(),void 0):(d(b),void 0))},"tap .ui-btn-refresh-wrap":function(){m.refresh()}},x.window_change=function(e){a(e.el).find(".main_wraper").height(s.container_height_with_head())},x.page_before_show=function(){window.localStorage.setItem("rank_nav_address","charm_rank"),c.footer_notice_ui_refresh(),y=s.get_local_poco_id()};var W;x.page_init=function(i,n,o){u=i,h=n,f=o,b=h[0]?h[0]:"day",W=e("refresh_btn")(),i.$el.find(".header").append(W.$el);var l=a(i.el).find("header"),r=e("page_back_btn")();l.prepend(r.$el);var _=a(i.el).find(".main_wraper"),c=e("scroll");p=c.new_scroll(_,{view_height:s.container_height_with_head(),use_lazyload:!0}),v=new T({el:u.$el.find("[day_list_charm_rank]")}),g=new Z({el:u.$el.find("[week_list_charm_rank]")}),m=new P,m.bind("reset",t,i),d(b)};var T=n.View.extend({initialize:function(e){},add_list_item:function(e){a(this.el).append(e.$el)},clear_list:function(){a(this.el).html("")},show:function(){a(this.el).show()},hide:function(){a(this.el).hide()}}),Z=n.View.extend({initialize:function(e){},add_list_item:function(e){a(this.el).append(e.$el)},clear_list:function(){a(this.el).html("")},show:function(){a(this.el).show()},hide:function(){a(this.el).hide()}}),S=e("page").new_page(x);return S}}),"function"==typeof process_add&&process_add();