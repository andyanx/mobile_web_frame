define("wo/pics_rank",["base_package","frame_package","btn_package","commom_function","wo_config","get_template","rank_nav","select_module","notice"],function(e,i){var a=e("zepto"),t=e("page_control"),n=e("backbone"),d=e("commom_function"),o=e("wo_config"),s=e("new_alert_v2"),l=e("mustache"),r=e("select_module")(),c=e("notice");i.route={"pics_rank(/:time)":"pics_rank"},i.new_page_entity=function(){function i(){d.page_pv_stat_action(),D=h.$el.find("[day_list_charm_rank]"),"week"==b?w.clear_list():"day"==b&&y.clear_list(),u.each(function(e){var i=parseInt(e.attributes.order_key);if(i>0&&4>i)var a=new E({model:e});else var a=new P({model:e});"week"==b?i>0&&4>i?(3==i&&a.$el.addClass("last"),w.add_top3_item(a,i)):w.add_normal_item(a):"day"==b&&(i>0&&4>i?(3==i&&a.$el.addClass("last"),y.add_top3_item(a,i)):y.add_normal_item(a))})}function _(e){var i=new P({model:e});"week"==b?w.add_normal_item(i):"day"==b&&y.add_normal_item(i)}function m(e,i){var a=1,e=parseInt(e),i=parseInt(i);return e>i?a=i/e:i>e&&(a=e/i),{one_pics_height:parseInt((window.innerWidth-20)*a),one_pics_width:parseInt(window.innerWidth-20),sec_and_thr_height:parseInt((window.innerWidth-25)/2),normal_pics_height:parseInt((window.innerWidth-32)/3)}}function p(e){h.$el.find("[data_select_date]").removeClass("cur"),h.$el.find("[data_select_date="+e+"]").addClass("cur"),0==k&&(j="all"),"day"==e&&(y.show(),w.hide(),0==y.get_list_count()&&u.refresh()),"week"==e&&(w.show(),y.hide(),0==w.get_list_count()&&u.refresh())}var f,g,h,v,u,b,w,y,x,k,$,z={title:"\u7167\u7247\u6392\u884c\u699c",route:{pics_rank:"pics_rank"},transition_type:"slide"},j="",C=21,I=[],T=!1,O=!1,q="",S={ajax_load_finish:function(e,i){if($.close(),O=!1,k>0){if(!x){if(I=i.location.select_list,I.length>0){if(q=i.location.cur_location_key,!T){var a=i.location.cur_location_name;h.$el.find("[data_city_value]").html(a),T=!0}h.$el.find("[data_select_location]").show()}else h.$el.find("[data_select_location]").hide();console.log("new select_module_class"),x=new r({options_data:I,default_key:q,onchange:function(){select_data=this.get_select_data(),j=select_data.key;var e=select_data.val;h.$el.find("[data_city_value]").html(e),y.clear_list(),w.clear_list(),u.refresh(),console.log("select cur_city :"+j),console.log("select cur_type :"+b)}})}}else x=null,h.$el.find("[data_select_location]").hide();"week"==b?(w.more_btn_reset(),(0==i.list||C>i.list.length)&&w.hide_more_btn()):"day"==b&&(y.more_btn_reset(),(0==i.list||C>i.list.length)&&y.hide_more_btn())},before_refresh:function(){O=!0,$=s.show({text:"\u6b63\u5728\u52a0\u8f7d",type:"loading",is_cover:!1,append_target:h.$el}),"week"==b?w.more_btn_loading():"day"==b&&y.more_btn_loading()},before_get_more:function(){O=!0,"week"==b?w.more_btn_loading():"day"==b&&y.more_btn_loading()}},N=n.Model.extend({defaults:{}}),V=n.Collection.extend({model:N,url:o.ajax_url.get_charm_expense_rank_list,refresh:function(){S.data={date_type:b,rank_type:"like_img",location_city:j},d.collection_refresh_function.call(this,S)},get_more_item:function(){d.collection_get_more_function.call(this,S)},parse:function(e){return e&&e.list!==void 0?e.list:e}}),E=n.View.extend({tagName:"div",className:"pics_rank_top_three_pics pics_rank_contanier dib re",initialize:function(){this.render()},events:{tap:function(){t.navigate_to_page("last/"+this.art_id,{cover_img_width:this.img_width,cover_img_height:this.img_height})}},render:function(){var e=this.model.toJSON();this.art_id=e.art_id,this.art_location_id=e.art_location_id,this.rank_value=e.rank_value,this.sort_num=parseInt(e.sort_num),this.img_width=parseInt(e.img_width),this.img_height=parseInt(e.img_height),this.user_name=e.user_name,this.sex=e.sex,this.item_count=parseInt(e.item_count),this.order_key=parseInt(e.order_key);var i="";if(1==this.order_key){d.is_empty(e.cover_img_url)||(e.cover_img_url=d.matching_img_size(e.cover_img_url,"mb"));var t=m().one_pics_width;i="width:"+t+"px;height:"+m(this.img_width,this.img_height,1).one_pics_height+"px;overflow:hidden",console.log("init ori_height:"+this.img_width,this.img_height)}else if(this.order_key>1&&3>=this.order_key){d.is_empty(e.cover_img_url)||(e.cover_img_url=d.matching_img_size(e.cover_img_url,"ss"));var t=m().sec_and_thr_height+"px",n=t;i="width:"+t+";height:"+n+";overflow:hidden"}var o='<div data-ori_img_width="'+this.img_width+'" data-ori_img_height="'+this.img_height+'" class="pics_container re mb5" style="'+i+'"><div class="num no_'+this.order_key+' icon-bg-common"></div><img src="{{cover_img_url}}" class="w-100 img_buffer_bg"><div class="des"><h4 class="clearfix"><span class="user_name colorfff f12 fl">{{user_name}}</span><i class="sex_icon fl icon-bg-common "></i></h4><div ><span class="love-icon dib vam icon-bg-common"></span><span class="like_count ml5 colorfff f10">+{{rank_value}}</span></div></div><div class="fade_pic_box w-100 bgc-0-85"></div></div>',s=l.to_html(o,e);a(this.el).html(s),"\u7537"==this.sex?a(this.el).find(".sex_icon").addClass("icon-male"):"\u5973"==this.sex&&a(this.el).find(".sex_icon").addClass("icon-female")}}),P=n.View.extend({tagName:"div",className:"pics_rank_normal_pics pics_rank_contanier dib mb5",initialize:function(){this.render()},events:{tap:function(){t.navigate_to_page("last/"+this.art_id,{cover_img_width:this.img_width,cover_img_height:this.img_height})}},render:function(){var e=this.model.toJSON();this.art_id=e.art_id,this.art_location_id=e.art_location_id,this.rank_value=e.rank_value,this.sort_num=e.sort_num,this.img_width=parseInt(e.img_width),this.img_height=parseInt(e.img_height),d.is_empty(e.cover_img_url)||(e.cover_img_url=d.matching_img_size(e.cover_img_url,"ss"));var i=m().normal_pics_height+"px",t=i,n='<div class="pics_container re"><div class="num dib tc colorfff f10 icon-bg-common">{{order_key}}</div><img style="width:'+t+";height:"+i+'" src="{{cover_img_url}}" data-pics_img class="w-100 img_buffer_bg"><div class="des"><div style="display:none"><span class="love-icon dib vam icon-bg-common"></span><span class="like_count ml5 colorfff f10">+{{rank_value}}</span></div></div></div>',o=l.to_html(n,e);a(this.el).html(o),"\u7537"==this.sex?a(this.el).find(".sex_icon").addClass("icon-male"):"\u5973"==this.sex&&a(this.el).find(".sex_icon").addClass("icon-female")}});z.initialize=function(){this.render()},z.render=function(){var i=e("get_template");i.template_obj(),e("footer_view");var t='<div class="wrap-box"><header class="header font_wryh fb tc re "><h3 class="tc" >\u7167\u7247\u699c</h3></header><div class="main_wraper"><div class="inside-page font_wryh" style="padding-top:45px;"><div style="overflow:hidden;position:relative;z-index: 1;"><div style="-webkit-transform:translateZ(0px);"></div></div><div class="main_container pb5"><div class="select-city-data clearfix mt10 content-10 color666"><div class="location_city bgcf0f border-style-be re fl radius-2px" data_select_location style="display:none"><span data_city_value class="city fl"></span><em class="fl ml20 icon-change mt5"></em></div><div class="data-list-change fr radius-2px"><ul class="clearfix"><li data_select_date="day">\u65e5\u699c</li><li data_select_date="week">\u5468\u699c</li></ul></div></div><div day_list_charm_rank><div class="list-item mt10 content-10"><table cellspacing="0" cellpadding="0" border="0" width="100%"><tr><td colspan="2" class="pics_view_container" data-top-three-view></td></tr><tr><td class="pics_view_container" data-top-three-view></td><td class="pics_view_container" data-top-three-view></td></tr></table><div data-normal-view class="pics_view_container"></div></div></div><div week_list_charm_rank style="display:none"><div class="list-item mt10 content-10"><table cellspacing="0" cellpadding="0" border="0" width="100%"><tr><td colspan="2" class="pics_view_container" data-top-three-view></td></tr><tr><td class="pics_view_container" data-top-three-view width="50%"></td><td class="pics_view_container" data-top-three-view width="50%"></td></tr></table><div data-normal-view class="pics_view_container"></div></div></div></div></div></div><footer class="footer"></footer></div>';this.$el.append(a(t))},z.events={"tap .ui-btn-prev-wrap":function(){t.back()},swipeleft:function(){!d.get_ua().is_uc},"tap [data_select_location]":function(){x.open()},"tap [data-for_week_get_more]":function(){return t.page_transit_status()?!1:(u.get_more_item(),void 0)},"tap [data-for_day_get_more]":function(){return t.page_transit_status()?!1:(u.get_more_item(),void 0)},"tap [data_select_date]":function(e){return O?void 0:(b=a(e.currentTarget).attr("data_select_date"),a(e.currentTarget).hasClass("cur")?(u.refresh(),void 0):(p(b),void 0))},"tap .ui-btn-refresh-wrap":function(){u.refresh()}},z.window_change=function(e){var i,t,n=m().sec_and_thr_height,o=m().normal_pics_height;"week"==b?(t=w.$el.find("[data-pics_img]"),i=w.$el.find(".pics_rank_top_three_pics")):(t=y.$el.find("[data-pics_img]"),i=y.$el.find(".pics_rank_top_three_pics"));var s=i.eq(0).find(".pics_container").attr("data-ori_img_width"),l=i.eq(0).find(".pics_container").attr("data-ori_img_height"),r=m(s,l,1).one_pics_height,c=m().one_pics_width;console.log("window change ori_height:"+s,l),i.eq(0).find(".pics_container").height(r).width(c),i.eq(1).find(".pics_container").width(n).height(n),i.eq(2).find(".pics_container").width(n).height(n),t.last().width()!=o&&t.width(o).height(o),a(e.el).find(".main_wraper").height(d.container_height_with_head())},z.page_before_show=function(){window.localStorage.setItem("rank_nav_address","pics_rank"),c.footer_notice_ui_refresh(),k=d.get_local_poco_id()};var W;z.page_init=function(t,n,o){h=t,g=n,v=o,W=e("refresh_btn")(),t.$el.find(".header").append(W.$el);var s=a(t.el).find("header"),l=e("page_back_btn")();s.prepend(l.$el),b=g[0]?g[0]:"day",h.$el.find(".data-list-change li").eq(0).addClass("cur");var r=a(t.el).find(".main_wraper"),c=e("scroll");f=c.new_scroll(r,{view_height:d.container_height_with_head()}),w=new J({el:h.$el.find("[week_list_charm_rank]")}),y=new L({el:h.$el.find("[day_list_charm_rank]")}),u=new V,u.bind("reset",i,t),u.bind("add",_,t),p(b)};var D,J=n.View.extend({initialize:function(i){var t=this,i=i||{};t.no_load_more=i.no_load_more||!1;var n=e("load_more_btn")();t.no_load_more||a(this.el).append(n.$el),n.$el.addClass("pl10 pr10"),n.$el.attr("data-for_week_get_more","1"),t.load_more_btn=n,t.load_more_btn.hide()},add_top3_item:function(e,i){a(this.el).find("[data-top-three-view]").eq(i-1).append(e.$el),this.no_load_more||this.load_more_btn.show()},add_normal_item:function(e){a(this.el).find("[data-normal-view]").append(e.$el),this.no_load_more||this.load_more_btn.show()},get_list_count:function(){return a(this.el).find(".pics_rank_contanier").length},clear_list:function(){a(this.el).find(".pics_view_container").html(""),this.load_more_btn.hide()},hide_more_btn:function(){this.load_more_btn.hide()},more_btn_loading:function(){this.load_more_btn.loadding()},more_btn_reset:function(){this.load_more_btn.reset()},show_more_btn:function(){this.load_more_btn.show()},show:function(){a(this.el).show()},hide:function(){a(this.el).hide()}}),L=n.View.extend({initialize:function(i){var t=this,i=i||{};t.no_load_more=i.no_load_more||!1;var n=e("load_more_btn")();t.no_load_more||a(this.el).append(n.$el),n.$el.addClass("pl10 pr10"),n.$el.attr("data-for_day_get_more","1"),t.load_more_btn=n,t.load_more_btn.hide()},add_top3_item:function(e,i){a(this.el).find("[data-top-three-view]").eq(i-1).append(e.$el),this.no_load_more||this.load_more_btn.show()},add_normal_item:function(e){a(this.el).find("[data-normal-view]").append(e.$el),this.no_load_more||this.load_more_btn.show()},get_list_count:function(){return a(this.el).find(".pics_rank_contanier").length},clear_list:function(){a(this.el).find(".pics_view_container").html(""),this.load_more_btn.hide()},hide_more_btn:function(){this.load_more_btn.hide()},more_btn_loading:function(){this.load_more_btn.loadding()},more_btn_reset:function(){this.load_more_btn.reset()},show_more_btn:function(){this.load_more_btn.show()},show:function(){a(this.el).show()},hide:function(){a(this.el).hide()}}),Z=e("page").new_page(z);return Z}}),"function"==typeof process_add&&process_add();