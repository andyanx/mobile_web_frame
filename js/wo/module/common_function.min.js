define("wo/module/common_function",["wo_config","base_package","ua","new_alert_v2","app_function"],function(e,i){function t(e,i){if(i===void 0&&(i="b"),0>e.indexOf(".poco.cn/mypoco/qing/"))return e;var t=e.lastIndexOf("/"),a=e.substring(0,t+1),n=e.substring(t+1),o=n.split("_"),d=o[0],s=o[1].split("x"),l=s[0],r=s[1],c=o[2].substring(0,1),_=o[2].substring(1,2);switch(_){case 1:var p=".gif";break;case 6:var p=".bmp";break;default:var p=".jpg"}var m=a+d+"_"+l+"x"+r+"_"+c+_+"0";switch(i){case"b":e=m+p;break;case"m":e=2==c?m+p:m+"_530.jpg";break;case"s":e=m+"_260.jpg";break;case"ss":e=m+"_170.jpg";break;case"ms":e=3==c?m+"_64.jpg":m+"_170.jpg";break;case"mm":e=3==c?m+"_300.jpg":m+"_260.jpg";break;case"mb":e=3==c?m+"_600.jpg":2==c?m+p:m+"_530.jpg"}return e}var a=e("wo_config"),n=e("zepto"),o=e("new_alert_v2"),d=e("ua"),s=e("cookies"),l=e("app_function");i.is_empty=function(e){var i=typeof e;switch(i){case"undefined":var t=!0;break;case"boolean":var t=!e;break;case"number":if(e>0)var t=!1;else var t=!0;break;case"string":if(""==e||"0">=e&&!isNaN(parseInt(e)))var t=!0;else var t=!1;break;case"object":if(null==e)var t=!0;else if(e instanceof Array)if(0==e.length)var t=!0;else var t=!1;else{var t=!0;for(var a in e)t=!1}break;default:var t=!1}return t},i.container_height_with_head_and_nav=function(){var e;return e=window.innerHeight-a.nav_bar_height},i.container_height_with_head=function(){var e;return e=window.innerHeight},i.photowall_colume_width=function(){return(window.innerWidth-(a.photowall_colume+1)*a.photowall_spacing)/a.photowall_colume},i.last_page_container_width=function(){return window.innerWidth-2*a.last_page_container_spacing},i.matching_img_size=function(e,i){var a=window.localStorage.getItem("open_hd_photo"),n=d.isIpad,o=i;if(a&&1==a)switch(i){case"mm":o=n?"m":"s";break;case"mb":o=n?"b":"m"}return t(e,o)},i.get_photowall_zoom_height_by_zoom_width=function(e,i){return r(e,i,this.photowall_colume_width())},i.get_last_page_zoom_height_by_zoom_width=function(e,i){return r(e,i,this.last_page_container_width())};var r=function(e,i,t){return parseInt(i*t/e)};i.like_photo_action=function(e,i,t){var t=t||"detail";this.send_request({url:a.ajax_url.like_action,data:{art_id:e,is_like:i,action_from:t}})},i.get_poco_id=function(e,i,t){var i=i||!1;this.send_request({url:a.ajax_url.poco_user,data:{params:0},callback:function(t){"function"==typeof e&&e.call(this,t),i&&l.save_device_token()},error:function(){"function"==typeof t&&t.call(this)}})},i.log_out=function(e){var i=this;i.set_local_poco_id(0),i.send_request({url:a.ajax_url.poco_user,data:{params:1},callback:function(i){"function"==typeof e&&e.call(this,i.poco_id)}})},i.get_local_poco_id=function(){return window.localStorage.getItem("poco_id")?parseInt(window.localStorage.getItem("poco_id")):0},i.get_publish_count=function(){return window.localStorage.getItem("publish_count")?parseInt(window.localStorage.getItem("publish_count")):0},i.set_local_poco_id=function(e){return window.localStorage.setItem("poco_id",e)},i.set_mmk=function(e){return window.localStorage.setItem("mmk",e)},i.set_show_my_wall=function(e){return window.localStorage.setItem("show_my_wall",e)},i.get_show_my_wall=function(){return window.localStorage.getItem("show_my_wall")},i.publish_login_requirement=function(){var e=this,i=s.readCookie("cok_framename"),t=e.get_local_poco_id();return e.is_empty(i)?0>=t?!0:!1:!1},i.collection_refresh_function=function(e){var i=this,e=e||{},t=e.before_refresh||null,d=e.ajax_load_finish||null,s=e.data||{};null==e.reset?!1:e.reset;var l=null==e.error_no_alert?!1:e.error_no_alert;if(i.onload)return!1;"function"==typeof t&&t.call(i),i.onload=!0,i.index_page=1;var r=parseInt((new Date).getTime()),c=n.extend(s,{page:1,t:r}),_=r,p=i.fetch({type:"GET",data:c,timeout:a.ajax_timeout,success:function(e,t){if(console.log(e),console.log(t),i.onload=!1,null==t&&(t=!1),t&&t.page_run_time){var a=(parseInt((new Date).getTime())-_)/1e3,n=t.page_run_time;if(a-n>5||n>10){var o=encodeURIComponent(i.url),s="http://imgtj.poco.cn/pocotj_touch.css?url=touch://mpoco/mobile/ajax_timeout?ajax_url="+o+"&page_run_time="+n+"&ajax_run_time="+a+"&tmp="+r+"&touch=1",l=new Image;l.src=s}var t=t.result_data;null==t&&(t=!1)}"function"==typeof d&&d.call(i,e,t,null,i.index_page)},error:function(){l||o.show({text:"\u6570\u636e\u8bf7\u6c42\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5",type:"info",auto_close_time:2e3}),i.onload=!1;var e=(parseInt((new Date).getTime())-_)/1e3,t=encodeURIComponent(i.url),a="http://imgtj.poco.cn/pocotj_touch.css?url=touch://mpoco/mobile/ajax_timeout?ajax_url="+t+"&page_run_time="+e+"&ajax_run_time="+e+"&tmp="+r+"&touch=1",n=new Image;n.src=a,"function"==typeof d&&d.call(i,null,null)}});return p},i.collection_get_more_function=function(e,i){var t=this,e=e||{},d=e.before_get_more||null,s=e.ajax_load_finish||null,l=e.data||{},r=null==e.remove?!0:e.remove,c=null==e.error_no_alert?!1:e.error_no_alert,t=this;if(t.onload)return!1;"function"==typeof d&&d.call(t),t.onload=!0;var _=parseInt((new Date).getTime());if(update=null!=i?!1:!0,i){if(1==t.index_page)return t.onload=!1,!1;var p=n.extend(l,{page:t.index_page-1,t:_})}else var p=n.extend(l,{page:t.index_page+1,t:_});var m=_,h=this.fetch({remove:r,update:update,type:"GET",data:p,timeout:a.ajax_timeout,success:function(e,a){if(t.onload=!1,null==a&&(a=!1),i?t.index_page--:t.index_page++,a&&a.page_run_time){var n=(parseInt((new Date).getTime())-m)/1e3,o=parseInt(a.page_run_time);if(n-o>5||o>10){var d=encodeURIComponent(t.url),l="http://imgtj.poco.cn/pocotj_touch.css?url=touch://mpoco/mobile/ajax_timeout?ajax_url="+d+"&page_run_time="+o+"&ajax_run_time="+n+"&tmp="+_+"&touch=1",r=new Image;r.src=l}var a=a.result_data;null==a&&(a=!1)}"function"==typeof s&&s.call(t,e,a,i,t.index_page)},error:function(){c||o.show({text:"\u6570\u636e\u8bf7\u6c42\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5",type:"info",auto_close_time:2e3}),t.onload=!1;var e=(parseInt((new Date).getTime())-m)/1e3,a=encodeURIComponent(t.url),n="http://imgtj.poco.cn/pocotj_touch.css?url=touch://mpoco/mobile/ajax_timeout?ajax_url="+a+"&page_run_time="+e+"&ajax_run_time="+e+"&tmp="+_+"&touch=1",d=new Image;d.src=n,"function"==typeof s&&s.call(t,null,null,i,t.index_page)}});return h},i.send_request=function(e){var e=e||{},i=e.url||"",t=e.type||"GET",d=e.data||{},s=e.callback||"",l=e.error||"",r=n.extend(d,{t:parseInt((new Date).getTime())});n.ajax({type:t,url:i,data:r,dataType:"json",timeout:a.ajax_timeout,success:function(e){"function"==typeof s&&s.call(this,e)},error:function(){o.show({text:"\u8bf7\u6c42\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5",type:"info",auto_close_time:2e3}),"function"==typeof l&&l.call(this)}})},i.page_pv_stat_action=function(){var e=window.location.hash;e=e.replace("#","");var i=e.indexOf("/");if(i>0){var t=e.substr(i+1,e.length);t=decodeURIComponent(t);var a=e.substr(0,i)}else var t="",a=e;var n=s.readCookie("_tj_mobile_come_from");n||(n="web");var o="come_from="+n+"&hash_parms="+t;o=encodeURIComponent(o);var d="http://imgtj.poco.cn/poco_tj.css?tj_query="+o+"&tj_file="+a+"&tmp="+Math.random(),l=new Image;l.src=d},i.get_ua=function(){return d},i.get_target_refresh_url_by_hash_name=function(e){var e=null==e?!1:e;if(e)var i="http://"+location.host+location.pathname+"?"+parseInt((new Date).getTime())+"#"+e;else var i="http://"+location.host+location.pathname+"?"+parseInt((new Date).getTime());return i},i.bind_poco_in_camera=function(e){var i=s.readCookie("poco_camera_ver"),t=window.localStorage.getItem("mmk"),a=this.get_local_poco_id();if(!this.is_empty(a)&&i>"2.1.0"&&!this.is_empty(t)){if(e)var n=0;else var n=3e3;setTimeout(function(){window.location.href="PocoCamera://action_bindpoco/?pcd="+a+"&mmk="+t,s.delCookie("world_user_login",".poco.cn","/")},n)}},i.update_ps_record=function(){console.log("update ps id");var e=window.localStorage.getItem("update_ps_pic_id");console.log(this.is_empty(e)),this.is_empty(e)||this.send_request({url:a.ajax_url.ps_upload,data:{update_id:e},callback:function(e){console.log("update ok:"),console.log(e),e.result.update_ok_id>0&&window.localStorage.setItem("update_ps_pic_id",0)},error:function(){}})},i.banner_tips=function(e){var e=e||{},i=e.html_str||"",t='<div class="banner_tips radius-2px clearfix re" style="padding: 15px 10px;"><div class="txt color333"><em class="icon icon-bg-common"></em><span >'+i+'</span></div><div class="btn-close-wrap"><span class="btn-close radius-2px"><i class="icon-close icon-bg-common"></i></span></div></div>';return t}}),"function"==typeof process_add&&process_add();