define("wo/module/world_list_module",["base_package","commom_function","frame_package","ua"],function(e){function t(){var t,m,h=n.Model.extend({defaults:{art_id:"",add_time:"",cmt_count:"",like_count:"",cover_img_width:"",cover_img_height:"",cover_img_url:"",summary:"",had_like:"",user_icon:"",user_id:"",user_nickname:"",user_sex:"",order_ukey:"",subject_tag:"",user_tag:""}}),u=n.Collection.extend({model:h,index_page:1,onload:!1,__ajax:function(e,n){var s=this,e=e||!1;if(o.is_empty(s.length)||e)var d=0;else var d=s.models[s.length-1].attributes.order_ukey;var r=a.extend(t.data,{page:s.index_page,order_ukey:d,t:parseInt((new Date).getTime())});s.onload=!0,this.fetch({type:"GET",data:r,timeout:i.ajax_timeout,success:function(){s.onload=!1,"function"==typeof t.oncomplete&&t.oncomplete.call(s),setTimeout(function(){"function"==typeof n&&n.call(s)},500)},error:function(){l.show({text:"\u6570\u636e\u8bf7\u6c42\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5",type:"info",auto_close_time:2e3}),s.onload=!1,"function"==typeof t.oncomplete&&t.oncomplete.call(s)}})},get_data:function(e,t){var i=this,e=e||!1;i.onload||(i.index_page=e?e:1,i.__ajax(!0,t))},get_next_page_data:function(){var e=this;e.onload||(e.index_page++,e.__ajax(!1))},get_pre_page_data:function(){var e=this;e.onload||(e.index_page--,0>=e.index_page&&(e.index_page=1),e.__ajax(!0))}}),f=n.View.extend({tagName:"div",className:"item-act bdb-line",art_id:"",user_id:"",user_nickname:"",cover_img_url:"",on_like:!1,initialize:function(){var t=e("get_template"),i=t.template_obj();this.template_html=i.photo_txt,console.log(this),this.user_nickname=this.model.attributes.user_nickname,this.cover_img_url=this.model.attributes.cover_img_url},events:{"tap .art-user-info":function(){return s.page_lock_status()?!1:(s.navigate_to_page("user_profile/"+this.user_id),void 0)},"tap poco_at":function(e){var t=e.currentTarget,i=a(t).attr("user_id");i>0&&s.navigate_to_page("user_profile/"+i)},"tap .tag-grid":function(e){var t=e.currentTarget,i=a(t).text(),n=encodeURIComponent(i);s.navigate_to_page("user_photo/"+this.user_id+"/"+n)},"tap .tag-theme":function(e){var t=e.currentTarget,i=a(t).text(),n=encodeURIComponent(i);s.navigate_to_page("theme_pic_list/"+n)},"tap .btn-comment":function(){s.navigate_to_page("cmt/"+this.art_id)},"tap .btn-love":"like_action","hold .img":function(){var e=this;o.is_empty(t.custom_data.theme_keyword)||o.is_empty(e.is_admin)||confirm("\u662f\u5426\u6392\u9664\u51fa\u8be5\u4e3b\u9898?")&&o.send_request({url:"http://m.poco.cn/mobile/action/del_keyword.php",data:{keyword:t.custom_data.theme_keyword,art_id:e.art_id}}),o.is_empty(t.custom_data.category_list)||o.is_empty(e.is_admin)||confirm("\u662f\u5426\u6392\u9664\u51fa\u8be5\u5206\u7c7b?")&&o.send_request({url:"http://m.poco.cn/mobile/action/cancel_article_category.php",data:{keyword:t.custom_data.theme_keyword,art_id:e.art_id}})},"tap [data_more_btn]":function(){var e=this;if(p.can_app_share())var i=!0,n=!0;else var i=!1,n=!1;p.is_world_app();var s={user_id:e.user_id,art_id:e.art_id,cover_img_url:e.cover_img_url,user_nickname:e.user_nickname};m?(m.show(),a.extend(m.extend_params,s)):(console.log("__init_interact_module_view"),m=new c({show_share_btn_list:i,extend_params:s,message_btn_obj:{show:!0,click_btn_callback:function(){this.control_nav_to_message_list(m.extend_params.user_id)}},report_btn_obj:{show:!0,click_btn_callback:function(e){if(e)e.open();else{var e=this.init_report_select_control(m.extend_params.art_id);e.open()}}},share_btn_obj:{show:i,show_share_btn_list:{sina:!0,qqweibo:!0,qqzone:!0,weixin:n},share_btn_list_click_callback:function(e){var t=m.extend_params.cover_img_url.replace("-c","");t="weixin"==e?o.matching_img_size(t,"ms"):o.matching_img_size(t,"mb");var i="\u5206\u4eab\u4e86 "+m.extend_params.user_nickname+" \u7684\u7cbe\u5f69\u7167\u7247\uff0c\uff08\u6765\u81ea #POCO\u4e16\u754c# \u624b\u673a\u62cd\u7167\u793e\u533a\uff09 ",a="http://wo.poco.cn/world_share.php?share_page=last&art_id="+m.extend_params.art_id;p.can_app_share()?p.app_share(e,t,i,a):this.share_img(e,t,i,a)}}}),t.page_view.append(m.$el),m.show())}},render:function(){var e=this,t=this.model.toJSON();if(o.is_empty(t.cover_img_url))return e.$el.hide(),!1;this.art_id=t.art_id,this.user_id=t.user_id,this.is_admin=t.is_admin,this.$el.attr("art_id",this.art_id);var i=this.img_size_sort(t);0>=i.like_count&&(i.like_count=""),0>=i.cmt_count&&(i.cmt_count="");var n=_.to_html(this.template_html,i);a(this.el).html(n)},img_size_sort:function(e){return e.cover_img_url_s=o.matching_img_size(e.cover_img_url,"mb"),1==e.had_like&&(e.like_style=1),"\u5973"==e.user_sex?e.sex_type="icon-female":"\u7537"==e.user_sex&&(e.sex_type="icon-male"),e.nickname||(e.nickname=e.user_nickname),e.img_show_height=o.get_last_page_zoom_height_by_zoom_width(e.cover_img_width,e.cover_img_height),e},like_action:function(){if(s.page_lock_status())return!1;var e=this,t=o.get_local_poco_id();if(0==t)return s.navigate_to_page("login"),void 0;var i=e.$el.find(".btn-love i");if(!e.on_like){e.on_like=!0;var a=e.$el.find("[replace_like_count]"),n=0;if(""!=a.html()&&(n=parseInt(a.html())),i.hasClass("cur")){i.removeClass("cur"),this.btn_love_obj&&this.btn_love_obj.removeClass("cur"),0>=n-1?a.html(""):a.html(n-1);var d=0}else{i.addClass("cur"),this.btn_love_obj&&this.btn_love_obj.addClass("cur"),a.html(n+1);var d=1}o.like_photo_action(e.art_id,d,"detail"),e.on_like=!1}}}),g=n.View.extend({tagName:"div",className:"photowall_item font_wryh",events:{"tap [data-anchor]":function(){if(0!=this.art_id){if("index_list"==this.photowall_item_type){var e="http://imgtj.poco.cn/pocotj_touch.css?url=touch://mpoco/mobile/editor?url_hash=last&txt="+encodeURIComponent("\u9996\u9875\u4f5c\u54c1")+"&tmp="+(new Date).getTime(),t=new Image;t.src=e}if(this.btn_love_obj=this.$el.find(".icon-love"),o.is_empty(this.source_page))var i="";else var i="/from_"+this.source_page;s.navigate_to_page("#last/"+this.art_id+i,{cover_img_width:this.cover_img_width,cover_img_height:this.cover_img_height,btn_love_obj:this.btn_love_obj,photo_txt_view:this.$el})}},"hold [data-anchor]":function(){var e=this;"new"!=e.source_page||o.is_empty(e.is_admin)||confirm("\u662f\u5426\u6392\u9664\u51fa\u6700\u65b0\u56fe\u7247?")&&o.send_request({url:"http://m.poco.cn/mobile/action/blacklist_user_from_new.php",data:{from:"new",art_id:e.art_id}}),"hot"!=e.source_page||o.is_empty(e.is_admin)||confirm("\u662f\u5426\u6392\u9664\u51fa\u70ed\u95e8\u56fe\u7247?")&&o.send_request({url:"http://m.poco.cn/mobile/action/blacklist_user_from_new.php",data:{from:"hot",art_id:e.art_id}}),o.is_empty(t.custom_data.theme_keyword)||o.is_empty(e.is_admin)||confirm("\u662f\u5426\u6392\u9664\u51fa\u8be5\u4e3b\u9898?")&&o.send_request({url:"http://m.poco.cn/mobile/action/del_keyword.php",data:{keyword:t.custom_data.theme_keyword,art_id:e.art_id}}),o.is_empty(t.custom_data.category_list)||o.is_empty(e.is_admin)||confirm("\u662f\u5426\u6392\u9664\u51fa\u8be5\u5206\u7c7b?")&&o.send_request({url:"http://m.poco.cn/mobile/action/cancel_article_category.php",data:{keyword:t.custom_data.theme_keyword,art_id:e.art_id}})},"tap [data-user-info]":function(){var e=parseInt(this.user_id);e>0&&s.navigate_to_page("user_profile/"+e)},"tap .love-div":function(){if(s.page_lock_status())return!1;var e=this;if(0!=this.art_id){if(poco_id=o.get_local_poco_id(),0==poco_id)return s.navigate_to_page("login"),void 0;if(!e.on_like){e.on_like=!0;var t=e.$el.find(".love_count_wrap"),i=e.$el.find(".icon-love"),a=e.$el.find(".love_count"),n=parseInt(a.html());if(i.hasClass("cur")){var d=n-1;0>d&&(d=0),0==d&&t.css("display","none"),a.html(d),i.removeClass("cur");var l=0}else{a.html(n+1),n+1>0&&t.css("display","block"),i.addClass("cur");var l=1}o.like_photo_action(e.art_id,l,"list"),e.on_like=!1}}}},initialize:function(e){if(o.is_empty(this.model.toJSON().cover_img_url))return!1;"6">r.ios_version&&this.$el.addClass("fixed_scroll_blink");var i=this.img_size_sort(this.model.toJSON());this.art_id=i.art_id,this.user_id=i.user_id,this.cover_img_width=i.cover_img_width,this.cover_img_height=i.cover_img_height,this.is_admin=i.is_admin,this.source_page=i.source_page;var n='<div class="love-div"><em class="icon-love icon-bg-common  {{#like_style}}cur{{/like_style}}"></em></div>';if("profile"==this.source_page||"profile"==t.photowall_content_type)var s='<div data-anchor class="me-pic-info"><div class="txt lh16">{{list_summary}}</div><div class="love-box color999 clearfix"><span class="love_count_wrap mr10 fl"><em class="icon-love icon-bg-common fl mr5"></em><i class="love_count fsn fl">{{like_count}}</i></span><span class="cmt_wrap fl"><em class="icon-comment icon-bg-common fl mr5"></em><i class="comment-count fsn fl">{{cmt_count}}</i></span></div></div>';else if("new"==this.source_page||"new"==t.photowall_content_type)var s='<div class="new-img-item"  data-user-info><table border="0" cellspacing="0" cellpadding="0"><tr><td width="40"><div class="img middle-center"><img lazyload_src="{{user_icon}}" class="max-width-height" /></div></td><td><div class="info-box color999"><h4 class="fwn color000 clearfix"><span class="fl">{{user_nickname}}</span><em class="{{sex_icon_type}} sex_icon icon-bg-common fl"></em></h4><div class="area">{{location_string}}</div></div></td></tr></table></div>';else var s='<div class="user-pic-info" data-user-info><table border="0" cellspacing="0" cellpadding="0"><tr><td width="40"><div class="img middle-center"><img lazyload_src="{{user_icon}}" class="max-width-height" /></div></td><td><div class="info-box color999"><h4 class="fwn color333"><span class="fl">{{user_nickname}}</span><em class="{{sex_icon_type}} sex_icon icon-bg-common fl"  style="margin-top:0px;"></em></h4><div class="love-cmt-box clearfix"><span class="love_count_wrap mr10 fl"><em class="icon-love icon-bg-common fl mr5 {{#like_style}}cur{{/like_style}}"></em><i class="love_count fsn fl">{{like_count}}</i></span><span class="cmt_wrap fl"><em class="icon-comment icon-bg-common fl mr5"></em><i class="comment-count fsn fl">{{cmt_count}}</i></span></div></div></td></tr></table></div>';0==this.art_id&&(n="");var d='<div class="item bdb-line"   art_id="{{art_id}}"  cover_img_width="{{cover_img_width}}"  cover_img_height="{{cover_img_height}}"><div data-anchor class="cover_img"><img  lazyload_src="{{{cover_img_url_s}}}"  style="height:{{img_show_height}}px;width:100%;"  class="img_buffer_bg"/></div>'+s+n,l=_.to_html(d,i);a(this.el).html(l);var c=this.$el.find(".cmt_wrap"),p=this.$el.find(".comment-count"),m=parseInt(p.html());0==m?c.css("display","none"):c.css("display","block");var h=this.$el.find(".love_count_wrap"),u=this.$el.find(".love_count"),f=parseInt(u.html());0==f?h.css("display","none"):h.css("display","block")},img_size_sort:function(e){return e.cover_img_url_s=o.matching_img_size(e.cover_img_url,"mm"),e.img_show_height=o.get_photowall_zoom_height_by_zoom_width(e.cover_img_width,e.cover_img_height),1==e.had_like&&(e.like_style=1),e.location_string=e.location_city==e.location_province||o.is_empty(e.location_city)?e.location_province:e.location_province+"\u00b7"+e.location_city,"\u7537"==e.user_sex?e.sex_icon_type="icon-male":"\u5973"==e.user_sex&&(e.sex_icon_type="icon-female"),e}}),v=n.View.extend({tagName:"div",className:"other_photowall_item photowall_item font_wryh",events:{"tap [data_to_link]":"nav_to_page"},initialize:function(){"6">r.ios_version&&this.$el.addClass("fixed_scroll_blink");var e=this.img_size_sort(this.model.toJSON());this.link_url=e.link_url,this.summary=e.summary,this.cover_img_height=e.img_show_height;var t='<div class="item bdb-line" data_to_link  cover_img_width="{{cover_img_width}}"  cover_img_height="{{cover_img_height}}"><div data-anchor class="cover_img"><img  lazyload_src="{{{cover_img_url_s}}}"  style="height:{{img_show_height}}px;width:100%;"  class="img_buffer_bg"/></div><div class="pop">{{summary}}</div>',i=_.to_html(t,e);a(this.el).html(i)},img_size_sort:function(e){return e.cover_img_url_s=o.matching_img_size(e.cover_img_url,"mm"),e.img_show_height=o.get_photowall_zoom_height_by_zoom_width(e.cover_img_width,e.cover_img_height),e},nav_to_page:function(){var e=this;if(!o.is_empty(e.link_url)){var t="http://imgtj.poco.cn/pocotj_touch.css?url=touch://mpoco/mobile/editor?url_hash="+encodeURIComponent(e.link_url)+"&txt="+encodeURIComponent(e.summary)+"&tmp="+(new Date).getTime(),i=new Image;i.src=t,s.navigate_to_page(e.link_url)}}}),b=n.View.extend({tagName:"section",className:"world_list_mvc",events:{"tap .next_paging_btn":function(){var e=this;return e.load_more_btn.get_next_page_btn_ban_mode()?!1:(e.__start_paging(),void 0)},"tap .pre_paging_btn":function(){var e=this;return e.load_more_btn.get_pre_page_btn_ban_mode()?!1:(e.__start_paging(!0),void 0)},"tap [photowall_type_btn]":function(){"photowall"!=this.index_list_type&&(this.__change_list_type_style(this.index_list_type),window.localStorage.setItem("user_choose_list_type","photowall"),this.__render_list(!0))},"tap [onelist_type_btn]":function(){"big_img_list"!=this.index_list_type&&(this.__change_list_type_style(this.index_list_type),window.localStorage.setItem("user_choose_list_type","big_img_list"),this.__render_list(!0))}},initialize:function(e){var i=this,e=e||{};t={url:"",data:{},parse:"",main_container:"",no_more_control:!1,list_type:"both",force_type:!1,init_page:1,page_count:20,custom_data:{},photowall_content_type:!1,page_view:{},onloading:"",onreset:"",oncomplete:"",onlisttypechange:""},t=a.extend(t,e),i.world_list_collection=new u,o.is_empty(t.url)||(i.world_list_collection.url=t.url),o.is_empty(t.parse)||(i.world_list_collection.parse=t.parse),i.world_list_collection.bind("reset",i.__collection_reset,i),i.__init_render()},__init_render:function(){var i=this;if(!o.is_empty(t.main_container)){d.template_obj();var n='<div class="list_type_control_container fixed_scroll_blink pt15 pb5" style="display:none;"><div append_html_container style="height:32px;position:absolute;left:0;max-width:60%;overflow:hidden;"></div><div class="ui-switch-btn-wrap border-style bgc-fff-e2e radius-2px"><div photowall_type_btn class="icon-photowall-select"><span class="icon-bg-common icon "></span></div><div onelist_type_btn class="icon-big-img-select"><span class="icon-bg-common icon"></span></div></div></div><div class="waterfall-item pt10 clearfix"><div class="imglist-item fl"><div class="mr5 left_colume"></div></div><div class="imglist-item fr "><div class="ml5 right_colume"></div></div><div class="actbox-item clearfix"  style="display:none"></div></div>';i.$el.html(n),t.main_container.html(i.$el),o.is_empty(t.append_html)||i.$el.find("[append_html_container]").append(t.append_html);var s=e("paging_btn")();o.is_empty(t.no_more_control)&&a(i.el).append(s.$el),i.load_more_btn=s,i.one_colume=a(i.el).find(".actbox-item"),i.photowall_type_btn=a(i.el).find("[photowall_type_btn]"),i.big_img_type_btn=a(i.el).find("[onelist_type_btn]"),"both"==t.list_type&&i.$el.find(".list_type_control_container").show(),i.left_colume=a(i.el).find(".left_colume"),i.right_colume=a(i.el).find(".right_colume")}},__change_list_type_style:function(e){var t=this;"photowall"==e?(t.photowall_type_btn.addClass("cur"),t.big_img_type_btn.removeClass("cur")):(t.photowall_type_btn.removeClass("cur"),t.big_img_type_btn.addClass("cur"))},__left_colume_height:0,__right_colume_height:0,__add_item_to_photowall_list:function(e){var i=this,a=!1,n=!1;if("none"!=t.main_container.css("display")){var o=i.left_colume.height(),s=i.right_colume.height();s>=o?a=!0:n=!0}else{var d=e.cover_img_height;i.__left_colume_height<=i.__right_colume_height?(a=!0,d&&(i.__left_colume_height+=d)):(n=!0,d&&(i.__right_colume_height+=d))}a?i.left_colume.append(e.$el):i.right_colume.append(e.$el),i.load_more_btn.show()},__add_item_to_big_img_list:function(e){var t=this;t.one_colume.append(e.$el),t.load_more_btn.show()},__empty_world_list:function(){var e=this;e.__left_colume_height=0,e.__right_colume_height=0,e.one_colume.html(""),e.left_colume.html(""),e.right_colume.html("")},__collection_reset:function(){var e=this;e.__render_list(),"function"==typeof t.onreset&&t.onreset.call(e,e.world_list_collection.index_page)},__render_list:function(e){var i=this,e=e||!1;if(e&&(t.force_type=!1),i.__empty_world_list(),o.is_empty(t.list_type)||"both"==t.list_type)var a=t.force_type||window.localStorage.getItem("user_choose_list_type")||"photowall";else var a=t.list_type;i.index_list_type=a,this.__change_list_type_style(i.index_list_type),i.world_list_collection.each(function(e){if("photowall"==a){if(i.one_colume.hide(),i.left_colume.show(),i.right_colume.show(),1==e.attributes.is_insert_special_item)var t=new v({model:e});else var t=new g({model:e});t.render(),i.__add_item_to_photowall_list(t)}else{i.one_colume.show(),i.left_colume.hide(),i.right_colume.hide();var n=new f({model:e});n.render(),i.__add_item_to_big_img_list(n)}}),i.__control_paging_btn(i.world_list_collection.index_page,i.world_list_collection.length),e&&"function"==typeof t.onlisttypechange&&t.onlisttypechange.call(i)},__control_paging_btn:function(e,i){var a=this;1>=e?a.load_more_btn.ban_pre_page_btn():a.load_more_btn.open_pre_page_btn(),t.page_count>i?a.load_more_btn.ban_next_page_btn():a.load_more_btn.open_next_page_btn()},__start_paging:function(e){var t=this,e=e||!1;e?t.world_list_collection.get_pre_page_data():t.world_list_collection.get_next_page_data(),t.__onload_trriget()},__onload_trriget:function(){var e=this;e.load_more_btn.loadding(),"function"==typeof t.onloading&&t.onloading.call(e)},start_reset:function(e,t){var i=this;i.__onload_trriget(),i.world_list_collection.get_data(e,t)},set_data:function(e){t.data=e},set_options:function(e){t=a.extend(t,e)}});return b}var i=e("wo_config"),a=e("zepto"),n=e("backbone"),o=e("commom_function"),s=e("page_control"),d=e("get_template"),l=e("new_alert_v2"),r=e("ua"),_=e("mustache"),c=e("interact_module"),p=e("app_function");return t}),"function"==typeof process_add&&process_add();