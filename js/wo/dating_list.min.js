define("wo/dating_list",["base_package","frame_package","btn_package","commom_function","wo_config","get_template","footer_view","new_alert_v2","img_process","popup"],function(e,t){var a=e("zepto");e("cookies");var i=e("page_control"),n=e("backbone"),o=e("commom_function"),l=e("wo_config"),r=e("new_alert_v2");e("img_process");var s=e("mustache");e("popup");var _=null,d=10,c="";t.route={dating_list:"dating_list"},t.new_page_entity=function(){function t(){o.page_pv_stat_action(),C.clear_list(),j.each(function(e){var t=new x({model:e,pic_size:h()});C.add_list_item(t)}),view_scroll_obj.scroll_to(0),$.$el&&$.$el.find("header").animate({translate3d:"0px, 0px, 0px"},0,"ease-in")}function p(e){var t=new x({model:e,pic_size:h()});C.add_list_item(t)}function f(){return parseInt((window.innerWidth-50-20-70)/3)}function h(){return parseInt((window.innerWidth-20-50)/4)}function u(e,t){window.localStorage.setItem(e,t)}function m(e){return window.localStorage.getItem(e)}function g(){for(var e=l.category_arr,t="",a=0;e.length>a;a++)t+='<span data-tag="'+e[a]+'" class="tag_text radius-2px">'+e[a]+"</span>";$.find(".tag_container").html(t)}var v={route:{dating_list:"dating_list"},transition_type:"slide",dom_not_cache:!0},b=n.Model.extend({defaults:{}}),w={ajax_load_finish:function(e,t,a,i){return _.close(),0==t&&(C.return_paging_btn().hide(),r.show({text:"\u6ca1\u6709\u5bfb\u627e\u5230\u5408\u9002\u7684\u4eba",type:"info",is_fade:!1,is_cover:!0,auto_close_time:1e3,closed_callback:function(){$.find("[data-dating_list]").show(),$.find("[data-filter_tag]").hide();var e=m("select_sex");o.is_empty(e)&&(e="\u5168\u90e8",u("select_sex",e),$.find("[data-sex_icon='"+e+"']").find(".base_style").addClass("cur")),u("location_id",""),u("location_value","\u6240\u6709\u5730\u533a"),c="",u("cat_conf_name",""),j.refresh()}})),$.find(".dating_list_container").css("visibility","visible"),null==t?(C.return_paging_btn().reset(),void 0):(i>1?($.find(".banner").hide(),C.return_paging_btn().open_pre_page_btn()):C.return_paging_btn().ban_pre_page_btn(),0==t||d>t.length?C.return_paging_btn().ban_next_page_btn():C.return_paging_btn().open_next_page_btn(),void 0)},before_refresh:function(){_=r.show({text:"\u5bfb\u627e\u4e2d",type:"loading",append_target:$,is_cover:!0,auto_close_time:!1})},before_get_more:function(){C.more_btn_loading()}},y=n.Collection.extend({model:b,refresh:function(){var e=m("select_sex");o.is_empty(e)&&(e="all"),"\u5168\u90e8"==e&&(e="all");var t=m("location_id");o.is_empty(t)&&(t="");var a=m("cat_conf_name");o.is_empty(a)&&(a=""),w.data={sex:e,location_id:t,cat_conf_name:a},o.collection_refresh_function.call(this,w)},get_more_item:function(e){var t=m("select_sex");o.is_empty(t)&&(t="all"),"\u5168\u90e8"==t&&(t="all");var a=m("location_id");o.is_empty(a)&&(a="");var i=m("cat_conf_name");o.is_empty(i)&&(i=""),this.models.length>0&&!e?w.data={sex:t,location_id:a,cat_conf_name:i}:v.data={},o.collection_get_more_function.call(this,w,e)},parse:function(e){return e&&e.result_data!==void 0?e.result_data:e},url:function(){return l.ajax_url.dating_list+"?is_online="+1}}),x=n.View.extend({className:"border_item bdb-line",tagName:"div",initialize:function(t){var i=this.img_size_sort(this.model.toJSON());i.location_name=i.location_province==i.location_city?i.location_city:o.is_empty(i.location_city)?i.location_province:i.location_province+"\u00b7"+i.location_city,this.user_id=i.user_id;var n='<div style="padding:10px"><table width="100%" border="0" cellspacing="0" cellpadding="0"><tbody><tr><td width="62" data-nav_userprofile="" data-user_nav><div class="user-img"><img lazyload_src="{{user_icon}}"></div></td><td data-nav_userprofile="" data-user_info="" data-user_nav><div class="clearfix"><div class="user_name fl" data-user_name="">{{nickname}}</div><span class="sex_icon_container {{#age}}has_age{{/age}}"><i class="sex_icon icon-bg-common fl " style="{{^age}}margin:0{{/age}}"></i><span class="age">{{age}}</span></span></div><div class="location_name" data-location_name="">{{location_name}}</div></td><td></td><td data-follow_btn_area align="right"></td></tr></tbody></table><div class="tag_container">{{#tags_arr}}<span class="tag_text radius-2px">{{tag_txt}}</span>{{/tags_arr}}</div><p class="des" style="{{^user_describe}}margin-top:0{{/user_describe}}">{{{user_describe}}}</p><div class="like-photo clearfix">{{#custom_data}}{{#cover_img_url_ss}}<img lazyload_src="{{cover_img_url_ss}}" data-nav_art="{{art_id}}" data-img_width="{{cover_img_url_width}}" data-img_height="{{cover_img_url_height}}" class="img_buffer_bg imgs " style="width:{{pic_size}}px;height:{{pic_size}}px;">{{/cover_img_url_ss}}{{/custom_data}}</div></div>';this.options=t;var l={};z&&(l=z.follow_btn_obj),new_follow_btn=e("follow_btn")(),I=new new_follow_btn({status:i.follow_status,user_id:i.user_id,other_follow_btn:l,account_type:"dating"}),this.new_follow_btn=I;var r=s.to_html(n,i);a(this.el).html(r),"\u7537"==i.sex?(a(this.el).find(".sex_icon_container").addClass("icon_male_color"),a(this.el).find(".sex_icon").addClass("icon_male_style")):"\u5973"==i.sex&&(a(this.el).find(".sex_icon_container").addClass("icon_female_color"),a(this.el).find(".sex_icon").addClass("icon_female_style")),i.had_like?this.$el.find(".btn-love i").addClass("cur"):this.$el.find(".btn-love i").removeClass("cur"),this.new_follow_btn&&(a(this.el).find("[data-follow_btn_area]").html(""),a(this.el).find("[data-follow_btn_area]").html(this.new_follow_btn.$el))},img_size_sort:function(e){for(var t=e.custom_data.length,a=0;t>a;a++){var i=e.custom_data[a];o.is_empty(i.cover_img_url)||(i.cover_img_url_ss=o.matching_img_size(i.cover_img_url,"ss"),i.pic_size=this.options.pic_size)}return e},events:{"tap [data-user_nav]":"navigate_to_user","tap [data-nav_art]":"navigate_to_art"},navigate_to_user:function(){if(this.user_id){var e;this.new_follow_btn&&(e=this.new_follow_btn),i.navigate_to_page("user_profile/"+this.user_id,{follow_btn_obj:e})}},navigate_to_art:function(e){var t=a(e.currentTarget).attr("data-nav_art"),n=a(e.currentTarget).attr("data-img_width"),o=a(e.currentTarget).attr("data-img_height");i.navigate_to_page("last/"+t+"/from_profile",{cover_img_width:n,cover_img_height:o})}}),k=n.View.extend({initialize:function(){var t=this,i=e("paging_btn")();a(this.el).parent().append(i.$el),t.load_more_btn=i},add_list_item:function(e){var t=this;a(this.el).append(e.$el),t.load_more_btn.show()},clear_list:function(){a(this.el).html("")},return_paging_btn:function(){return this.load_more_btn},more_btn_loading:function(){this.load_more_btn.loadding()}});v.initialize=function(){this.render()},v.render=function(){var t=e("get_template"),i=t.template_obj(),n=i.dating;this.$el.append(a(n))},v.events={"tap .ui-btn-prev-wrap":function(){i.back()},"tap [data-back_to_list]":function(){$.find("[data-dating_list]").show(),$.find("[data-filter_tag]").hide()},swiperight:function(){o.get_ua().is_uc||i.back()},"tap [data-sex_icon]":function(e){var t=$.find("[data-sex_icon]"),i=a(e.currentTarget);t.find(".base_style").removeClass("cur"),t.find(".icon_text").removeClass("cur"),i.find(".base_style").addClass("cur"),i.find(".icon_text").addClass("cur");var n="";"\u5168\u90e8"==i.attr("data-sex_icon")?(n="all",u("select_sex","\u5168\u90e8")):(n=i.attr("data-sex_icon"),u("select_sex",n))},"tap [data-to_nav_location]":function(){i.navigate_to_page("set_location",{edit_location_obj:$.find("[data-location_value]")})},"tap [data-filter_out]":function(){$.find("[data-dating_list]").show(),$.find("[data-filter_tag]").hide();var e=$.find("[data-location_value]").attr("data-city_id"),t=$.find("[data-location_value]").val();o.is_empty(e)&&(e=""),c=encodeURIComponent(m("tag_selected")),u("location_id",e),u("location_value",t),j.refresh()},"tap [data-filter_in]":function(){$.find("[data-dating_list]").hide(),$.find("[data-filter_tag]").show();var e=m("select_sex"),t=m("location_id"),a=m("location_value");$.find("[data-sex_icon]").find(".base_style").removeClass("cur"),$.find("[data-sex_icon]").find(".icon_text").removeClass("cur"),o.is_empty(e)&&(e="\u5168\u90e8"),$.find("[data-sex_icon='"+e+"']").find(".base_style").addClass("cur"),$.find("[data-sex_icon='"+e+"']").find(".icon_text").addClass("cur"),t?($.find("[data-location_value]").val(a),$.find("[data-location_value]").attr("data-city_id",t)):$.find("[data-location_value]").val("\u6240\u6709\u5730\u533a"),$.find("[data-tag]").removeClass("selected");var i=m("tag_selected");$.find("[data-tag='"+i+"']").addClass("selected");var n="http://imgtj.poco.cn/poco_tj.css?tj_file=filter&tmp="+Math.random(),l=new Image;l.src=n},"tap .pre_paging_btn":function(){var e=C.return_paging_btn();return e.get_pre_page_btn_ban_mode()?!1:(j.get_more_item(!0),void 0)},"tap .next_paging_btn":function(){var e=C.return_paging_btn();return e.get_next_page_btn_ban_mode()?!1:(j.get_more_item(!1),void 0)},"tap [data-tag]":function(e){var t=a(e.currentTarget);t.hasClass("selected")?(u("tag_selected",""),t.removeClass("selected")):($.find("[data-tag]").removeClass("selected"),t.addClass("selected"),u("tag_selected",t.attr("data-tag")))}};var $,z,j,C,I;v.page_before_show=function(){var e=$.find(".base_style"),t=f();e.width(t).height(t),a(window).bind("resize",function(){var t=f();e.width(t).height(t),$.find(".like-photo img").css({height:"auto"})})},v.window_change=function(e){a(e.el).find(".imgs").width(h()).height(h())};var T;v.page_init=function(i,n,l){$=a(i.el),T=o.get_local_poco_id();var r=a(i.el).find(".dating_list"),s=e("scroll");view_scroll_obj=s.new_scroll(r,{view_height:o.container_height_with_head(),use_lazyload:!0}),view_filter_scroll_obj=s.new_scroll(a(i.el).find(".filter_info_container"),{view_height:o.container_height_with_head(),use_lazyload:!0}),l&&l.tag_name?(c=encodeURIComponent(l.tag_name),u("tag_selected",l.tag_name)):c=encodeURIComponent(m("tag_selected")),z=l,j=new y,C=new k({el:$.find(".dating_list_container")}),j.bind("reset",t,i),j.bind("add",p,i),j.refresh();var _=a(i.el).find("header[data-dating_list]"),d=e("page_back_btn")();_.prepend(d.$el),g()};var N=e("page").new_page(v);return N}}),"function"==typeof process_add&&process_add();